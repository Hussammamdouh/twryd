import{r as a,u as K,a as X,b as Y,j as e}from"./index-BBFhNgLA.js";import{g as y,p as w,a as Z,d as ee}from"./api-BUuAVsLY.js";import{L as te}from"./ErrorBoundary-C7XI_3jQ.js";import{M as se}from"./Modal-BllzMBoT.js";const ae=c=>{if(!c)return"-";try{return new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},I=c=>c?parseFloat(c).toFixed(2):"0.00";function ie(){const[c,C]=a.useState([]),[V,A]=a.useState([]),[n,D]=a.useState(null),[k,R]=a.useState([]),[$,q]=a.useState([]),[E,M]=a.useState(!1),[z,d]=a.useState(!1),[u,L]=a.useState(""),[m,_]=a.useState({name:"",name_ar:"",phone:"",email:""}),[p,S]=a.useState({product_id:"",quantity:1}),[g,F]=a.useState({real_client_id:""}),[x,h]=a.useState(!1),{token:o,logout:T}=K(),r=X(),v=Y(),i=t=>{t.status===401||t.message?.includes("Unauthorized")?(r.show("Session expired. Please log in again.","error"),T(),v("/login-supplier")):r.show(t.message||"An error occurred","error")},j=async()=>{try{M(!0);const t=await y("/api/supplier/clients",{token:o});console.log("Virtual Clients API Response:",t);const s=t.data?.clients||t.data||[];console.log("Processed virtual clients data:",s),C(s)}catch(t){console.error("Failed to load virtual clients:",t),i(t)}finally{M(!1)}},U=async()=>{try{const t=await y("/api/supplier/invitations/clients",{token:o});console.log("Real Clients API Response:",t);const s=t.data?.clients||t.data||[];console.log("Processed real clients data:",s),A(s)}catch(t){console.error("Failed to load real clients:",t),i(t)}},H=async()=>{try{const t=await y("/api/supplier-management/products",{token:o});console.log("Products API Response:",t);const s=t.data?.products||t.data||[];console.log("Processed products data:",s),q(s)}catch(t){console.error("Failed to load products:",t),i(t)}},f=async t=>{try{const s=await y(`/api/supplier/cart/${t}/items`,{token:o});console.log("Cart Items API Response:",s);const l=s.data?.items||s.data||[];console.log("Processed cart data:",l),R(l)}catch(s){console.error("Failed to load cart items:",s),i(s)}},W=async()=>{try{if(h(!0),!m.name||!m.phone||!m.email){r.show("Please fill in all required fields","error");return}const t=await w("/api/supplier/clients",{data:m,token:o});t.success?(r.show("Virtual client created successfully","success"),d(!1),_({name:"",name_ar:"",phone:"",email:""}),j()):r.show(t.message||"Failed to create virtual client","error")}catch(t){console.error("Create virtual client error:",t),i(t)}finally{h(!1)}},B=async()=>{if(n)try{if(h(!0),!p.product_id||!p.quantity){r.show("Please select a product and quantity","error");return}const t=await w(`/api/supplier/cart/${n.id}/items`,{data:p,token:o});t.success?(r.show("Item added to cart successfully","success"),d(!1),S({product_id:"",quantity:1}),f(n.id)):r.show(t.message||"Failed to add item to cart","error")}catch(t){console.error("Add to cart error:",t),i(t)}finally{h(!1)}},O=async(t,s)=>{if(n)try{const l=await Z(`/api/supplier/cart/${n.id}/items/${t}`,{data:{quantity:s},token:o});l.success?(r.show("Cart item updated successfully","success"),f(n.id)):r.show(l.message||"Failed to update cart item","error")}catch(l){console.error("Update cart item error:",l),i(l)}},Q=async t=>{if(n)try{const s=await ee(`/api/supplier/cart/${n.id}/items/${t}`,{token:o});s.success?(r.show("Item removed from cart successfully","success"),f(n.id)):r.show(s.message||"Failed to remove item from cart","error")}catch(s){console.error("Remove from cart error:",s),i(s)}},G=async()=>{if(!(!n||!g.real_client_id))try{h(!0);const t=await w(`/api/supplier/clients/${n.id}/merge/${g.real_client_id}`,{data:{},token:o});t.success?(r.show("Virtual client merged successfully","success"),d(!1),F({real_client_id:""}),j()):r.show(t.message||"Failed to merge virtual client","error")}catch(t){console.error("Merge virtual client error:",t),i(t)}finally{h(!1)}},N=(t,s=null)=>{L(t),D(s),t==="cart"&&s&&f(s.id),d(!0)},b=a.useCallback((t,s)=>{_(l=>({...l,[t]:s}))},[]),P=a.useCallback((t,s)=>{S(l=>({...l,[t]:s}))},[]),J=a.useCallback((t,s)=>{F(l=>({...l,[t]:s}))},[]);return a.useEffect(()=>{o?(j(),U(),H()):(r.show("Please log in to access this page","error"),v("/login-supplier"))},[o,v]),E?e.jsx("div",{className:"min-h-screen bg-theme-bg p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(te,{type:"dashboard"})})}):e.jsx("div",{className:"min-h-screen bg-theme-bg p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-theme-text mb-2",children:"Virtual Client Management"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Create and manage virtual clients, their carts, and merge with real clients"})]}),e.jsx("div",{className:"mb-6 flex space-x-4",children:e.jsx("button",{onClick:()=>N("create"),className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:"Create Virtual Client"})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-theme-border",children:[e.jsx("h2",{className:"text-lg font-semibold text-theme-text",children:"Virtual Clients"}),e.jsx("p",{className:"text-sm text-theme-text-secondary mt-1",children:"Manage your virtual clients and their shopping carts"})]}),c.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-theme-text-muted mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-theme-text mb-2",children:"No virtual clients"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Create your first virtual client to get started."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-theme-border",children:[e.jsx("thead",{className:"bg-theme-surface",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Client Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Created Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-theme-border",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-theme-surface transition-colors duration-200",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-theme-text",children:t.name}),t.name_ar&&e.jsx("div",{className:"text-sm text-theme-text-secondary",children:t.name_ar})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-theme-text",children:t.email}),e.jsx("div",{className:"text-sm text-theme-text-secondary",children:t.phone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-theme-text-secondary",children:ae(t.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:"Virtual"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>N("cart",t),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",children:"Manage Cart"}),e.jsx("button",{onClick:()=>N("merge",t),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"Merge"})]})})]},t.id))})]})})]}),e.jsxs(se,{open:z,onClose:()=>d(!1),title:u==="create"?"Create Virtual Client":u==="cart"?`Manage Cart - ${n?.name}`:u==="merge"?`Merge Virtual Client - ${n?.name}`:"Modal",children:[u==="create"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:m.name,onChange:t=>b("name",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"Enter client name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Name (Arabic)"}),e.jsx("input",{type:"text",value:m.name_ar,onChange:t=>b("name_ar",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"Enter client name in Arabic"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",value:m.phone,onChange:t=>b("phone",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:m.email,onChange:t=>b("email",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",placeholder:"Enter email address",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-theme-text-secondary hover:text-theme-text transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"button",onClick:W,disabled:x,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Creating...":"Create Client"})]})]}),u==="cart"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-theme-surface rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-text mb-4",children:"Add to Cart"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Product"}),e.jsxs("select",{value:p.product_id,onChange:t=>P("product_id",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"Select a product"}),$.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - $",I(t.price)]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:p.quantity,onChange:t=>P("quantity",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white"})]})]}),e.jsx("button",{onClick:B,disabled:x,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Adding...":"Add to Cart"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-text mb-4",children:"Cart Items"}),k.length===0?e.jsx("p",{className:"text-theme-text-secondary text-center py-4",children:"No items in cart"}):e.jsx("div",{className:"space-y-2",children:k.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-theme-surface rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-theme-text",children:t.product?.name||"Unknown Product"}),e.jsxs("div",{className:"text-sm text-theme-text-secondary",children:["$",I(t.product?.price)," each"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:s=>O(t.id,parseInt(s.target.value)),className:"w-16 px-2 py-1 border border-theme-border rounded text-sm"}),e.jsx("button",{onClick:()=>Q(t.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 text-sm",children:"Remove"})]})]},t.id))})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-theme-text-secondary hover:text-theme-text transition-colors duration-200",children:"Close"})})]}),u==="merge"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Merge Warning"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-300",children:e.jsx("p",{children:"Merging will transfer all virtual client data (orders, cart items, etc.) to the selected real client. This action cannot be undone."})})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text mb-1",children:"Select Real Client to Merge With *"}),e.jsxs("select",{value:g.real_client_id,onChange:t=>J("real_client_id",t.target.value),className:"w-full px-3 py-2 border border-theme-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"Select a real client"}),V.map(t=>e.jsxs("option",{value:t.id,children:[t.client?.name||t.name," - ",t.client?.email||t.email]},t.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-theme-text-secondary hover:text-theme-text transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"button",onClick:G,disabled:x||!g.real_client_id,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Merging...":"Merge Client"})]})]})]})]})})}export{ie as default};
