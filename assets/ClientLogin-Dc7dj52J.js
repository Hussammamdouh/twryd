import{r as l,u as y,a as j,b as k,c as N,j as e,L}from"./index-BBFhNgLA.js";import{p as m}from"./api-BUuAVsLY.js";function A(){const[h,x]=l.useState(""),[u,f]=l.useState(""),[c,p]=l.useState(!1),[r,g]=l.useState(!1),{login:v,token:d}=y(),a=j(),i=k(),w=N(),s=new URLSearchParams(w.search).get("invitation_token");l.useEffect(()=>{(async()=>{if(d&&s)try{await m("/api/client/invitations/accept",{token:d,data:{token:s}}),a.show("Invitation accepted successfully!","success"),setTimeout(()=>{i("/client/dashboard/invitations")},1500)}catch(t){console.error("Error accepting invitation after login:",t),t.message.includes("Invalid")||t.message.includes("not found")||t.message.includes("expired")?a.show("This invitation link is invalid or has expired. Please contact the supplier for a new invitation.","error"):a.show(t.message||"Failed to accept invitation","error"),setTimeout(()=>{i("/client/dashboard")},1e3)}})()},[d,s,i,a]);const b=async o=>{o.preventDefault(),p(!0);try{const t=await m("/api/client/login",{data:{email_or_phone:h,password:u}});if(t.data&&t.data.token&&t.data.client)if(v(t.data.token,{...t.data.client,role:"client"}),a.show("Login successful!","success"),s)try{console.log("Accepting invitation after login with token:",s),await m("/api/client/invitations/accept",{token:t.data.token,data:{token:s}}),a.show("Invitation accepted successfully!","success"),setTimeout(()=>{i("/client/dashboard/invitations")},1500)}catch(n){console.error("Error accepting invitation after login:",n),n.message.includes("Invalid")||n.message.includes("not found")||n.message.includes("expired")?a.show("This invitation link is invalid or has expired. Please contact the supplier for a new invitation.","error"):a.show(n.message||"Failed to accept invitation","error"),setTimeout(()=>{i("/client/dashboard")},1e3)}else setTimeout(()=>i("/client/dashboard"),1e3);else throw new Error(t.message||"Login failed")}catch(t){a.show(t.message,"error")}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-theme-bg px-2 py-8",role:"main",children:e.jsxs("div",{className:"theme-card w-full max-w-md p-8 sm:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-center mb-2 tracking-tight text-theme-text",children:"Client Login"}),s&&e.jsx("div",{className:"w-full mb-4 p-3 bg-primary-50 border border-primary-200 rounded-lg dark:bg-primary-900/30 dark:border-primary-700",children:e.jsxs("p",{className:"text-sm text-primary-800 dark:text-primary-200",children:[e.jsx("strong",{children:"Invitation detected!"})," After login, your invitation will be automatically accepted."]})}),e.jsx("div",{className:"w-16 h-1 bg-gradient-to-r from-primary-500 to-primary-600 rounded-full mb-8"}),e.jsxs("form",{onSubmit:b,className:"w-full flex flex-col gap-7","aria-busy":c,children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"emailOrPhone",className:"text-base font-medium text-theme-text",children:"Email or Phone"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-theme-text-muted","aria-hidden":"true",children:e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M3 6.75A2.75 2.75 0 0 1 5.75 4h12.5A2.75 2.75 0 0 1 21 6.75v10.5A2.75 2.75 0 0 1 18.25 20H5.75A2.75 2.75 0 0 1 3 17.25V6.75Zm0 0L12 13.25L21 6.75"})})}),e.jsx("input",{id:"emailOrPhone",type:"text",autoComplete:"username",required:!0,className:"theme-input w-full pl-10 pr-4 py-3 rounded-md text-base shadow-sm",placeholder:"Enter your email or phone",value:h,onChange:o=>x(o.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"password",className:"text-base font-medium text-theme-text",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-theme-text-muted","aria-hidden":"true",children:e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm6-6V9a6 6 0 1 0-12 0v2a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5a2 2 0 0 0-2-2Zm-8-2a4 4 0 1 1 8 0v2H8V9Z"})})}),e.jsx("input",{id:"password",type:r?"text":"password",autoComplete:"current-password",required:!0,className:"theme-input w-full pl-10 pr-12 py-3 rounded-md text-base shadow-sm",placeholder:"Enter your password",value:u,onChange:o=>f(o.target.value)}),e.jsx("button",{type:"button",onClick:()=>g(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-md text-theme-text-muted hover:text-theme-text hover:bg-theme-surface transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 focus:ring-offset-theme-card","aria-label":r?"Hide password":"Show password",title:r?"Hide password":"Show password",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:r?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})})})]})]}),e.jsx("div",{className:"flex justify-between text-sm mt-4",children:e.jsx(L,{to:"/forgot-password-client",className:"text-primary-600 hover:underline",children:"Forgot Password?"})}),e.jsxs("button",{type:"submit",disabled:c,"aria-label":"Login",className:"theme-button w-full py-3 font-bold rounded-lg shadow-lg hover:scale-[1.02] hover:shadow-xl active:scale-95 transition-all duration-150 disabled:opacity-60 text-base mt-2 flex items-center justify-center gap-2",children:[c&&e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),c?"Logging in...":"Login"]})]})]})})}export{A as default};
