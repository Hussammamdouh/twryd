import{R as ae,j as e,r as i,u as se,a as B}from"./index-BciHiggx.js";import{S as H}from"./Spinner-DWZXuFTn.js";import{g as E,p as re,a as O,d as ie}from"./api-BUuAVsLY.js";import{M as de}from"./Modal-ZBCWTlSA.js";import{C as ne}from"./ConfirmActionModal-CiPUw9AP.js";import{P as oe}from"./Pagination-BGThXI18.js";const ce=function({products:l,loading:F,error:u,onEdit:b,onDelete:w,onToggleStatus:o,categories:k,recentlyUpdated:m={},actionResult:y={},deleteLoading:d}){return F?e.jsx("div",{className:"flex justify-center py-12 text-theme-text-secondary",children:"Loading products..."}):u?e.jsx("div",{className:"flex justify-center py-12 text-red-500",children:u}):!l||l.length===0?e.jsx("div",{className:"flex justify-center py-12 text-theme-text-muted",children:"No products found."}):e.jsx("div",{className:"overflow-x-auto rounded-lg shadow bg-white dark:bg-gray-900",children:e.jsxs("table",{className:"min-w-full text-sm md:table bg-white dark:bg-gray-900",role:"table","aria-label":"Products Table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-200",role:"row",children:[e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Product Name"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"SKU"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Category"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Price"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Discount"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Status"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900",role:"rowgroup",children:l.map(a=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 transition-colors duration-300 ${m[a.id]?y[a.id]==="success"?"ring-2 ring-green-400 bg-green-50 dark:bg-green-900/20":"ring-2 ring-red-400 bg-red-50 dark:bg-red-900/20":""}`,role:"row",tabIndex:0,"aria-label":`Product: ${a.name}, SKU: ${a.sku}`,children:[e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:a.sku}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:k.find(f=>f.id===a.category_id)?.name||"N/A"}),e.jsxs("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:["$",parseFloat(a.price||0).toFixed(2)]}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:a.discount?`${a.discount}%`:"-"}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${a.is_active?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,"aria-label":a.is_active?"Active":"Inactive",children:a.is_active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 rounded shadow text-xs font-bold hover:bg-blue-200 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400",onClick:()=>b(a),"aria-label":`Edit product ${a.name}`,tabIndex:0,children:"Edit"}),e.jsx("button",{className:"px-3 py-1 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded shadow text-xs font-bold hover:bg-red-200 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-red-400",onClick:()=>w(a),"aria-label":`Delete product ${a.name}`,tabIndex:0,disabled:d&&m[a.id],children:d&&m[a.id]?e.jsx("svg",{className:"w-4 h-4 animate-spin text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):"Delete"}),e.jsx("button",{className:`px-3 py-1 ${a.is_active?"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"} rounded shadow text-xs font-bold hover:bg-gray-200 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-green-400`,onClick:()=>o(a),"aria-label":a.is_active?`Deactivate product ${a.name}`:`Activate product ${a.name}`,tabIndex:0,disabled:m[a.id]&&y[a.id]===void 0,children:m[a.id]&&y[a.id]===void 0?e.jsx("svg",{className:"w-4 h-4 animate-spin text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):a.is_active?"Deactivate":"Activate"}),y[a.id]==="success"&&!d&&e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),y[a.id]==="error"&&!d&&e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]},a.id))})]})})},le=ae.memo(ce);function ue({open:x,onClose:l,onSubmit:F,initialData:u,categories:b,isEdit:w}){const[o,k]=i.useState({name:"",price:"",discount:"",description:"",product_url:"",category_id:"",is_active:!0}),[m,y]=i.useState(!1),[d,a]=i.useState({}),f=B();i.useEffect(()=>{x&&(k({name:u?.name||"",price:u?.price||"",discount:u?.discount||"",description:u?.description||"",product_url:u?.product_url||"",category_id:u?.category_id||"",is_active:u?.is_active??!0}),a({}))},[x,u]);function S(n,c){switch(n){case"name":return c?"":"Name is required.";case"price":return c?isNaN(c)||Number(c)<0?"Price must be a positive number.":"":"Price is required.";case"discount":return c===""?"Discount is required.":isNaN(c)||Number(c)<0||Number(c)>100?"Discount must be 0-100.":"";case"description":return c?"":"Description is required.";case"category_id":return c?"":"Category is required.";default:return""}}function M(){const n={};return n.name=S("name",o.name),n.price=S("price",o.price),n.discount=S("discount",o.discount),n.description=S("description",o.description),n.category_id=S("category_id",o.category_id),a(n),!Object.values(n).some(Boolean)}const h=n=>{const{name:c,value:D,type:p,checked:L}=n.target,$=p==="checkbox"?L:D;k(_=>({..._,[c]:$})),a(_=>{if(_[c]){const v={..._};return delete v[c],v}return _})},C=async n=>{if(n.preventDefault(),!M()){f.show("Please fix the errors in the form.","error");return}y(!0);try{await F(o),f.show(w?"Product updated!":"Product added!","success"),l()}catch(c){f.show(c.message||"Failed to submit","error")}finally{y(!1)}};return e.jsx(de,{open:x,onClose:l,title:w?"Edit Product":"Add New Product",className:"max-w-lg",children:e.jsxs("form",{onSubmit:C,className:"flex flex-col gap-4",noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Name"}),e.jsx("input",{name:"name",value:o.name,onChange:h,required:!0,className:"theme-input w-full px-3 py-2 rounded"}),d.name&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:d.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Price"}),e.jsx("input",{name:"price",type:"number",min:"0",value:o.price,onChange:h,required:!0,className:"theme-input w-full px-3 py-2 rounded"}),d.price&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:d.price})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Discount (%)"}),e.jsx("input",{name:"discount",type:"number",min:"0",max:"100",value:o.discount,onChange:h,required:!0,className:"theme-input w-full px-3 py-2 rounded"}),d.discount&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:d.discount})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Description"}),e.jsx("textarea",{name:"description",value:o.description,onChange:h,required:!0,className:"theme-input w-full px-3 py-2 rounded"}),d.description&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:d.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Product Image URL"}),e.jsx("input",{name:"product_url",value:o.product_url,onChange:h,className:"theme-input w-full px-3 py-2 rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-theme-text",children:"Category"}),e.jsxs("select",{name:"category_id",value:o.category_id,onChange:h,required:!0,className:"theme-input w-full px-3 py-2 rounded",children:[e.jsx("option",{value:"",children:"Select category"}),b&&b.length>0?b.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id)):e.jsx("option",{value:"",disabled:!0,children:"No categories available"})]}),d.category_id&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:d.category_id}),b&&b.length===0&&e.jsx("div",{className:"text-yellow-500 text-xs mt-1",children:"No categories found. Please contact admin."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",name:"is_active",type:"checkbox",checked:o.is_active,onChange:h,className:"focus:ring-2 focus:ring-primary-400"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-theme-text",children:"Active"})]}),e.jsx("button",{type:"submit",disabled:m,className:"theme-button w-full py-2 font-bold rounded transition disabled:opacity-60 mt-2",children:m?e.jsx(H,{size:20}):w?"Save Changes":"Add Product"})]})})}function ye(){const[x,l]=i.useState([]),[F,u]=i.useState(!1),[b,w]=i.useState(""),[o,k]=i.useState([]),[m,y]=i.useState(""),[d,a]=i.useState(""),[f,S]=i.useState(""),[M,h]=i.useState(!1),[C,n]=i.useState(null),[c,D]=i.useState(!1),[p,L]=i.useState(null),[$,_]=i.useState(!1),{token:v,user:q}=se(),P=B(),[T,R]=i.useState(1),[W,K]=i.useState(1),[z,A]=i.useState({}),[U,j]=i.useState({}),V=async(t=T)=>{u(!0),w("");try{const r=await E(`/api/supplier-management/products?page=${t}&per_page=10`,{token:v}),s=r.data?.data||r.data?.products?.data||r.data?.products||r.data||[];l(s),K(r.data?.last_page||r.data?.products?.last_page||1)}catch(r){w(r.message||"Failed to load products")}finally{u(!1)}},I=async()=>{try{const t=await E("/api/client-management/available-categories"),r=Array.isArray(t.data)?t.data:t.data?.data||[];k(r)}catch{try{const t=await E("/api/v1/categories"),r=Array.isArray(t.data)?t.data:t.data?.data||[];k(r)}catch{k([])}}};i.useEffect(()=>{v&&V(T),I()},[v,T]);const G=async t=>{const r=Math.random().toString(36).slice(2),s={...t,id:r},N=x;l([s,...x]);try{const g=new FormData;g.append("name",t.name),g.append("price",t.price),g.append("discount",t.discount||"0"),g.append("description",t.description||""),g.append("product_url",t.product_url||""),g.append("category_id",t.category_id),g.append("supplier_id",q.id),g.append("is_active",t.is_active?"1":"0");const Z=await re("/api/supplier-management/products",{token:v,data:g});l(ee=>[Z.data,...ee.filter(te=>te.id!==r)]),P.show("Product added!","success")}catch(g){l(N),P.show(g.message||"Failed to add product","error")}},J=async t=>{const r=x;l(x.map(s=>s.id===C.id?{...s,...t}:s));try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("discount",t.discount||"0"),s.append("description",t.description||""),s.append("product_url",t.product_url||""),s.append("category_id",t.category_id),s.append("supplier_id",q.id),s.append("is_active",t.is_active?"1":"0"),await O(`/api/supplier-management/products/${C.id}`,{token:v,data:s}),P.show("Product updated!","success")}catch(s){l(r),P.show(s.message||"Failed to update product","error")}},Q=async()=>{_(!0);try{await ie(`/api/supplier-management/products/${p.id}`,{token:v}),l(t=>t.filter(r=>r.id!==p.id)),A(t=>({...t,[p.id]:!0})),j(t=>({...t,[p.id]:"success"})),setTimeout(()=>{A(t=>({...t,[p.id]:!1})),j(t=>({...t,[p.id]:void 0}))},2e3),P.show("Product deleted!","success"),D(!1),L(null)}catch(t){A(r=>({...r,[p.id]:!0})),j(r=>({...r,[p.id]:"error"})),setTimeout(()=>{A(r=>({...r,[p.id]:!1})),j(r=>({...r,[p.id]:void 0}))},2e3),P.show(t.message||"Failed to delete product","error")}finally{_(!1)}},X=async t=>{const r=x;l(x.map(s=>s.id===t.id?{...s,is_active:!s.is_active}:s)),A(s=>({...s,[t.id]:!0})),j(s=>({...s,[t.id]:void 0}));try{await O(`/api/supplier-management/products/${t.id}`,{token:v,data:{is_active:!t.is_active}}),j(s=>({...s,[t.id]:"success"})),setTimeout(()=>{A(s=>({...s,[t.id]:!1})),j(s=>({...s,[t.id]:void 0}))},2e3),P.show("Product status updated!","success")}catch(s){l(r),j(N=>({...N,[t.id]:"error"})),setTimeout(()=>{A(N=>({...N,[t.id]:!1})),j(N=>({...N,[t.id]:void 0}))},2e3),P.show(s.message||"Failed to update status","error")}},Y=i.useMemo(()=>x.filter(t=>{const r=!m||t.name&&t.name.toLowerCase().includes(m.toLowerCase())||t.sku&&t.sku.toLowerCase().includes(m.toLowerCase()),s=!d||String(t.category_id)===String(d),N=!f||(f==="active"?t.is_active:!t.is_active);return r&&s&&N}),[x,m,d,f]);return e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 text-theme-text",children:"My Products"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsx("input",{type:"text",placeholder:"Search by name or SKU...",value:m,onChange:t=>y(t.target.value),className:"theme-input px-3 py-2 rounded w-full","aria-label":"Search products"}),e.jsxs("select",{value:d,onChange:t=>a(t.target.value),className:"theme-input px-3 py-2 rounded","aria-label":"Filter by category",children:[e.jsx("option",{value:"",children:"All Categories"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:f,onChange:t=>S(t.target.value),className:"theme-input px-3 py-2 rounded","aria-label":"Filter by status",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsx("button",{onClick:()=>{n(null),h(!0)},className:"theme-button px-5 py-2 rounded font-bold",children:"+ Add Product"})]}),F?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(H,{size:32})}):b?e.jsx("div",{className:"flex justify-center py-12 text-red-500",children:b}):e.jsxs(e.Fragment,{children:[e.jsx(le,{products:Y,loading:!1,error:null,onEdit:t=>{n(t),h(!0)},onDelete:t=>{L(t),D(!0)},onToggleStatus:X,categories:o,recentlyUpdated:z,actionResult:U,deleteLoading:$}),e.jsx(oe,{page:T,totalPages:W,onPageChange:R})]}),e.jsx(ue,{open:M,onClose:()=>h(!1),onSubmit:C?J:G,initialData:C,categories:o,isEdit:!!C}),e.jsx(ne,{isOpen:c,onClose:()=>D(!1),onConfirm:Q,title:"Delete Product",message:`Are you sure you want to delete "${p?.name}"? This action cannot be undone.`,confirmText:"Delete Product",confirmColor:"red",loading:$})]})}export{ye as default};
