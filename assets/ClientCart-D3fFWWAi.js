import{u as S,a as F,b as L,r as i,j as e}from"./index-BciHiggx.js";import{g as M,d as E,a as _}from"./api-BUuAVsLY.js";import{S as q}from"./Spinner-DWZXuFTn.js";function U(){const{token:n}=S(),x=F(),v=L(),[s,g]=i.useState(null),[k,p]=i.useState(!0),[y,b]=i.useState({}),[N,f]=i.useState({}),[l,j]=i.useState(""),u=async()=>{p(!0);try{const a=await M("/api/client/cart",{token:n});g(a.data?.cart||null)}catch{g(null)}finally{p(!1)}};i.useEffect(()=>{u()},[n]);const o=i.useMemo(()=>{if(!s||!s.items)return[];const a=new Map;s.items.forEach(r=>{const d=r.supplier_id||r.supplier?.id||"unknown",h=r.supplier?.name||"Unknown Supplier",m=r.supplier?.email||"";a.has(d)||a.set(d,{id:d,name:h,email:m,items:[]}),a.get(d).items.push(r)});let t=Array.from(a.values());return l&&(t=t.filter(r=>r.id===l||r.name.toLowerCase().includes(l.toLowerCase()))),t},[s,l]),w=async a=>{b(t=>({...t,[a.id]:!0}));try{await E(`/api/client/cart/items/${a.id}`,{token:n}),x.show("Item removed from cart","success"),u()}catch(t){x.show(t.message||"Failed to remove item","error")}finally{b(t=>({...t,[a.id]:!1}))}},C=async(a,t)=>{if(!(t<1)){f(r=>({...r,[a.id]:!0}));try{await _(`/api/client/cart/items/${a.id}`,{token:n,data:{quantity:t}}),u()}catch(r){x.show(r.message||"Failed to update quantity","error")}finally{f(r=>({...r,[a.id]:!1}))}}},c=i.useMemo(()=>{if(!s||!s.items)return{total:0,count:0};if(l){let r=0,d=0;return o.forEach(h=>{h.items.forEach(m=>{r+=parseFloat(m.total_price||0),d+=m.quantity})}),{total:r,count:d}}let a=0,t=0;return s.items.forEach(r=>{a+=parseFloat(r.total_price||0),t+=r.quantity}),{total:a,count:t}},[s,o,l]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-xl",children:e.jsx("svg",{className:"w-6 h-6 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Shopping Cart"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-normal text-lg sm:text-xl ml-2",children:"Review your items"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Update quantities, remove items, or proceed to checkout."})]}),s&&s.items&&s.items.length>0&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Filter by Supplier"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:l,onChange:a=>j(a.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200"})]}),l&&e.jsx("button",{onClick:()=>j(""),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium transition-colors",children:"Clear Filter"})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"flex-1 space-y-8",children:k?e.jsx("div",{className:"flex justify-center py-24",children:e.jsx(q,{size:32})}):o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Add products to your cart to see them here."})]}):o.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-4",children:[e.jsxs("div",{className:"font-semibold mb-4 text-gray-900 dark:text-white",children:["Supplier: ",a.name]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.items.map(t=>e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded flex items-center justify-center",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"max-h-14 object-contain"}):e.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-600 rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:t.product?.name||"Unknown Product"}),e.jsxs("div",{className:"text-gray-500 text-sm",children:["$",t.unit_price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:1,value:t.quantity,onChange:r=>C(t,Number(r.target.value)),className:"w-16 px-2 py-1 border rounded text-center bg-white dark:bg-gray-700 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600",disabled:N[t.id]}),e.jsxs("span",{className:"font-bold text-primary-600 text-lg",children:["$",t.total_price]})]}),e.jsx("button",{className:"text-red-500 hover:underline ml-4 text-sm font-semibold disabled:opacity-60",onClick:()=>w(t),disabled:y[t.id],children:y[t.id]?"Removing...":"Remove"})]},t.id))}),e.jsxs("div",{className:"text-right font-bold text-xl mt-4",children:["Subtotal: ",e.jsxs("span",{className:"text-blue-600",children:["$",a.items.reduce((t,r)=>t+parseFloat(r.total_price||0),0).toFixed(2)]})]})]},a.id))}),e.jsx("div",{className:"w-full lg:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-4",children:[e.jsx("div",{className:"font-semibold mb-2 text-gray-900 dark:text-white",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Total Items:"}),e.jsxs("span",{children:[c.count," ",c.count===1?"item":"items"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold mb-4",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"text-blue-600",children:["$",c.total.toFixed(2)]})]}),e.jsx("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg mb-2 disabled:opacity-60",disabled:c.count===0,onClick:()=>v("/client/dashboard/checkout"),children:"Proceed to Checkout"}),e.jsx("button",{className:"w-full bg-gray-200 text-gray-700 rounded-lg py-2 font-semibold mt-2",onClick:()=>window.location.href="/client/dashboard/my-marketplace",children:"Continue Shopping"})]})})]})]})}export{U as default};
