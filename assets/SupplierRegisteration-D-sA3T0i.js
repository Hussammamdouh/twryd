import{r as c,a as R,j as e}from"./index-BciHiggx.js";import{g as $,p as A}from"./api-BUuAVsLY.js";import{F as w}from"./FileUpload-Ca9oY3IU.js";const L=[{value:"",label:"Select Role"},{value:"Management",label:"Management"},{value:"Accounting",label:"Accounting"},{value:"Owner",label:"Owner"}],I=2*1024*1024,F=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,q=/^01[0-9]{9}$|^\+?[0-9]{10,15}$/;function M(){const[s,p]=c.useState({name:"",email:"",phone:"",whatsapp:"",password:"",password_confirmation:"",tax_card_number:"",cr_number:"",category_id:"",latitude:"",longitude:"",key_persons:[{name:"",role:"",phone:"",email:""},{name:"",role:"",phone:"",email:""}],logo:null,tax_card_file:null,cr_file:null}),[t,x]=c.useState({key_persons:[{name:"",role:"",phone:"",email:""},{name:"",role:"",phone:"",email:""}]}),[h,v]=c.useState(!1),[E,j]=c.useState([]),[N,k]=c.useState(!0),[f,C]=c.useState(""),_=R();c.useEffect(()=>{async function a(){k(!0),C("");try{const r=await $("/api/v1/categories"),l=Array.isArray(r.data)?r.data:r.data?.data||[];j(l)}catch{j([]),C("Failed to load categories")}finally{k(!1)}}a()},[]),c.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(a=>{p(r=>({...r,latitude:a.coords.latitude.toFixed(6),longitude:a.coords.longitude.toFixed(6)}))},a=>{console.log("Location access denied or error:",a.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},[]);function n(a,r,l){switch(a){case"email":return r?F.test(r)?"":"Invalid email format.":"Email is required.";case"phone":case"whatsapp":return r?q.test(r)?"":"Invalid phone number.":"Phone is required.";case"password":return r?r.length<6?"Password must be at least 6 characters.":"":"Password is required.";case"password_confirmation":return r?r!==s.password?"Passwords do not match.":"":"Please confirm your password.";case"logo":case"tax_card_file":case"cr_file":{const o=l?l[0]:s[a];return o?a==="logo"&&o&&!o.type.startsWith("image/")?"Logo must be an image.":(a==="tax_card_file"||a==="cr_file")&&o&&!(o.type.startsWith("image/")||o.type==="application/pdf")?"File must be an image or PDF.":o&&o.size>I?"File must be less than 2MB.":"":"This file is required."}case"category_id":return r?"":"Category is required.";case"tax_card_number":return r?"":"Tax card number is required.";case"cr_number":return r?"":"CR number is required.";default:return""}}function g(a,r,l){return l?r==="email"&&!F.test(l)?"Invalid email.":r==="phone"&&!q.test(l)?"Invalid phone.":"":"Required."}function S(){const a={};return a.name=s.name?"":"Name is required.",a.email=n("email",s.email),a.phone=n("phone",s.phone),a.whatsapp=n("whatsapp",s.whatsapp),a.password=n("password",s.password),a.password_confirmation=n("password_confirmation",s.password_confirmation),a.tax_card_number=n("tax_card_number",s.tax_card_number),a.cr_number=n("cr_number",s.cr_number),a.category_id=n("category_id",s.category_id),a.logo=n("logo",s.logo?s.logo:null),a.tax_card_file=n("tax_card_file",s.tax_card_file?s.tax_card_file:null),a.cr_file=n("cr_file",s.cr_file?s.cr_file:null),a.key_persons=s.key_persons.map((r,l)=>({name:r.name?"":"Required.",role:r.role?"":"Required.",phone:g(l,"phone",r.phone),email:g(l,"email",r.email)})),x(a),!Object.values(a).some(r=>Array.isArray(r)?r.some(l=>Object.values(l).some(Boolean)):!!r)}const i=a=>{const{name:r,value:l,files:o}=a.target;if(r.startsWith("key_persons")){const[d,b,y]=r.match(/key_persons\[(\d+)\]\[(\w+)\]/);p(m=>{const u=[...m.key_persons];return u[Number(b)][y]=l,{...m,key_persons:u}}),x(m=>{const u=m.key_persons?[...m.key_persons]:[{name:"",role:"",phone:"",email:""},{name:"",role:"",phone:"",email:""}];return u[Number(b)][y]=g(Number(b),y,l),{...m,key_persons:u}})}else o?(p(d=>({...d,[r]:o[0]})),x(d=>({...d,[r]:n(r,"",o)}))):(p(d=>({...d,[r]:l})),x(d=>({...d,[r]:n(r,l)})))},P=async a=>{if(a.preventDefault(),!S()){_.show("Please fix the errors in the form.","error");return}v(!0);try{const r=new FormData;r.append("name",s.name),r.append("email",s.email),r.append("phone",s.phone),r.append("whatsapp",s.whatsapp),r.append("password",s.password),r.append("password_confirmation",s.password_confirmation),r.append("tax_card_number",s.tax_card_number),r.append("cr_number",s.cr_number),r.append("category_ids[0]",s.category_id),r.append("latitude",s.latitude),r.append("longitude",s.longitude),s.key_persons.forEach((l,o)=>{r.append(`key_persons[${o}][name]`,l.name),r.append(`key_persons[${o}][role]`,l.role),r.append(`key_persons[${o}][phone]`,l.phone),r.append(`key_persons[${o}][email]`,l.email)}),s.logo&&r.append("logo",s.logo),s.tax_card_file&&r.append("tax_card_file",s.tax_card_file),s.cr_file&&r.append("cr_file",s.cr_file),await A("/api/supplier/register",{data:r}),_.show("Supplier registered successfully!","success")}catch(r){_.show(r.message,"error")}finally{v(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-theme-bg px-2 py-8",role:"main",children:e.jsxs("div",{className:"theme-card w-full max-w-lg p-8 sm:p-10 flex flex-col items-center",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-extrabold text-center mb-2 tracking-tight text-theme-text",children:"Supplier Registration"}),e.jsx("div",{className:"w-20 h-1 bg-gradient-to-r from-primary-500 to-primary-600 rounded-full mb-8"}),e.jsxs("form",{onSubmit:P,className:"w-full flex flex-col gap-6",encType:"multipart/form-data","aria-busy":h,noValidate:!0,children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"name",className:"text-base font-medium text-theme-text",children:"Name"}),e.jsx("input",{id:"name",name:"name",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Supplier name",value:s.name,onChange:i,"aria-invalid":!!t.name,"aria-describedby":t.name?"name-error":void 0}),t.name&&e.jsx("div",{id:"name-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.name})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"email",className:"text-base font-medium text-theme-text",children:"Email"}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Supplier email",value:s.email,onChange:i,"aria-invalid":!!t.email,"aria-describedby":t.email?"email-error":void 0}),t.email&&e.jsx("div",{id:"email-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.email})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"phone",className:"text-base font-medium text-theme-text",children:"Phone"}),e.jsx("input",{id:"phone",name:"phone",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Supplier phone",value:s.phone,onChange:i,"aria-invalid":!!t.phone,"aria-describedby":t.phone?"phone-error":void 0}),t.phone&&e.jsx("div",{id:"phone-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.phone})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"whatsapp",className:"text-base font-medium text-theme-text",children:"WhatsApp"}),e.jsx("input",{id:"whatsapp",name:"whatsapp",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Supplier WhatsApp",value:s.whatsapp,onChange:i,"aria-invalid":!!t.whatsapp,"aria-describedby":t.whatsapp?"whatsapp-error":void 0}),t.whatsapp&&e.jsx("div",{id:"whatsapp-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.whatsapp})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"password",className:"text-base font-medium text-theme-text",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Password",value:s.password,onChange:i,"aria-invalid":!!t.password,"aria-describedby":t.password?"password-error":void 0}),t.password&&e.jsx("div",{id:"password-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.password})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"password_confirmation",className:"text-base font-medium text-theme-text",children:"Confirm Password"}),e.jsx("input",{id:"password_confirmation",name:"password_confirmation",type:"password",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Confirm password",value:s.password_confirmation,onChange:i,"aria-invalid":!!t.password_confirmation,"aria-describedby":t.password_confirmation?"password_confirmation-error":void 0}),t.password_confirmation&&e.jsx("div",{id:"password_confirmation-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.password_confirmation})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"tax_card_number",className:"text-base font-medium text-theme-text",children:"Tax Card Number"}),e.jsx("input",{id:"tax_card_number",name:"tax_card_number",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Tax card number",value:s.tax_card_number,onChange:i,"aria-invalid":!!t.tax_card_number,"aria-describedby":t.tax_card_number?"tax_card_number-error":void 0}),t.tax_card_number&&e.jsx("div",{id:"tax_card_number-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.tax_card_number})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"cr_number",className:"text-base font-medium text-theme-text",children:"CR Number"}),e.jsx("input",{id:"cr_number",name:"cr_number",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"CR number",value:s.cr_number,onChange:i,"aria-invalid":!!t.cr_number,"aria-describedby":t.cr_number?"cr_number-error":void 0}),t.cr_number&&e.jsx("div",{id:"cr_number-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.cr_number})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"category_id",className:"text-base font-medium text-theme-text",children:"Category"}),e.jsx("select",{id:"category_id",name:"category_id",required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",value:s.category_id,onChange:i,"aria-invalid":!!t.category_id,"aria-describedby":t.category_id?"category_id-error":void 0,disabled:N||!!f,children:N?e.jsx("option",{value:"",children:"Loading categories..."}):f?e.jsx("option",{value:"",children:f}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Select Category"}),E.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),t.category_id&&e.jsx("div",{id:"category_id-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.category_id})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-base font-medium text-theme-text",children:"Key Persons"}),[0,1].map(a=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-2",children:[e.jsx("input",{name:`key_persons[${a}][name]`,required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Name",value:s.key_persons[a].name,onChange:i,"aria-invalid":!!(t.key_persons&&t.key_persons[a]&&t.key_persons[a].name),"aria-describedby":t.key_persons&&t.key_persons[a]&&t.key_persons[a].name?`key_persons-${a}-name-error`:void 0}),e.jsx("select",{name:`key_persons[${a}][role]`,required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",value:s.key_persons[a].role,onChange:i,children:L.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("input",{name:`key_persons[${a}][phone]`,required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Phone",value:s.key_persons[a].phone,onChange:i,"aria-invalid":!!(t.key_persons&&t.key_persons[a]&&t.key_persons[a].phone),"aria-describedby":t.key_persons&&t.key_persons[a]&&t.key_persons[a].phone?`key_persons-${a}-phone-error`:void 0}),e.jsx("input",{name:`key_persons[${a}][email]`,required:!0,className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Email",value:s.key_persons[a].email,onChange:i,"aria-invalid":!!(t.key_persons&&t.key_persons[a]&&t.key_persons[a].email),"aria-describedby":t.key_persons&&t.key_persons[a]&&t.key_persons[a].email?`key_persons-${a}-email-error`:void 0})]},a)),t.key_persons&&t.key_persons.map((a,r)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-2",children:[e.jsx("div",{className:"w-full text-red-500 text-xs mt-1",id:`key_persons-${r}-name-error`,role:"alert",children:a.name}),e.jsx("div",{className:"w-full text-red-500 text-xs mt-1",id:`key_persons-${r}-role-error`,role:"alert",children:a.role}),e.jsx("div",{className:"w-full text-red-500 text-xs mt-1",id:`key_persons-${r}-phone-error`,role:"alert",children:a.phone}),e.jsx("div",{className:"w-full text-red-500 text-xs mt-1",id:`key_persons-${r}-email-error`,role:"alert",children:a.email})]},r))]}),e.jsx(w,{id:"logo",name:"logo",accept:"image/*",required:!0,onChange:i,label:"Logo",error:t.logo,maxSize:2*1024*1024,ariaInvalid:!!t.logo,ariaDescribedby:t.logo?"logo-error":void 0}),t.logo&&e.jsx("div",{id:"logo-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.logo}),e.jsx(w,{id:"tax_card_file",name:"tax_card_file",accept:"application/pdf,image/*",required:!0,onChange:i,label:"Tax Card File",error:t.tax_card_file,maxSize:2*1024*1024,ariaInvalid:!!t.tax_card_file,ariaDescribedby:t.tax_card_file?"tax_card_file-error":void 0}),t.tax_card_file&&e.jsx("div",{id:"tax_card_file-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.tax_card_file}),e.jsx(w,{id:"cr_file",name:"cr_file",accept:"application/pdf,image/*",required:!0,onChange:i,label:"CR File",error:t.cr_file,maxSize:2*1024*1024,ariaInvalid:!!t.cr_file,ariaDescribedby:t.cr_file?"cr_file-error":void 0}),t.cr_file&&e.jsx("div",{id:"cr_file-error",className:"text-red-500 text-xs mt-1",role:"alert",children:t.cr_file}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"latitude",className:"text-base font-medium text-theme-text",children:"Latitude"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"latitude",id:"latitude",className:"theme-input flex-1 px-4 py-3 rounded-md text-base",placeholder:"Latitude will be auto-detected",value:s.latitude,onChange:i}),e.jsx("button",{type:"button",onClick:()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(a=>{p(r=>({...r,latitude:a.coords.latitude.toFixed(6),longitude:a.coords.longitude.toFixed(6)}))},a=>{console.log("Location access denied or error:",a.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},className:"px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",title:"Get current location",children:"📍"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{htmlFor:"longitude",className:"text-base font-medium text-theme-text",children:"Longitude"}),e.jsx("input",{type:"text",name:"longitude",id:"longitude",className:"theme-input w-full px-4 py-3 rounded-md text-base",placeholder:"Longitude will be auto-detected",value:s.longitude,onChange:i})]})]}),e.jsxs("button",{type:"submit",disabled:h,"aria-label":"Register",className:"theme-button w-full py-3 font-bold rounded-lg shadow-lg hover:scale-[1.02] hover:shadow-xl active:scale-95 transition-all duration-150 disabled:opacity-60 text-base mt-2 flex items-center justify-center gap-2",children:[h&&e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z","aria-hidden":"true"})]}),h?"Registering...":"Register"]})]})]})})}export{M as default};
