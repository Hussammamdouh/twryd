import{u as A,r as h,a as _,j as e,R as W}from"./index-Cclg67os.js";import{u as F}from"./useQuery-xOW4UwSP.js";import{p as z,a as M,d as D,g as E}from"./api-BUuAVsLY.js";import{M as S}from"./Modal-DoRxSVjK.js";import{F as I}from"./FileUpload-BGMLlkR2.js";const $="https://back.twryd.com";function B(a){return a?a.startsWith("http")?a:`${$}/${a.replace(/^\//,"")}`:null}const q=2*1024*1024;function H({open:a,onClose:g,onSubmit:f,initialData:i,isEdit:t}){const[o,m]=h.useState({name:"",icon:null,is_active:!0,remove_icon:!1}),[y,k]=h.useState(!1),[x,p]=h.useState({}),b=_();W.useEffect(()=>{a&&(m({name:i?.name||"",icon:null,is_active:i?.is_active??!0,remove_icon:!1}),p({}))},[a,i]);function j(n,s,w){switch(n){case"name":return s?"":"Name is required.";case"icon":{const d=o.icon;return!t&&!d?"Icon is required.":d&&!d.type.startsWith("image/")?"Icon must be an image.":d&&d.size>q?"Icon must be less than 2MB.":""}default:return""}}function N(){const n={};return n.name=j("name",o.name),n.icon=j("icon",o.icon),p(n),!Object.values(n).some(Boolean)}const u=n=>{const{name:s,value:w,type:d,checked:C,files:L}=n.target;d==="file"?(m(r=>({...r,icon:L[0]})),p(r=>{if(r.icon){const l={...r};return delete l.icon,l}return r})):d==="checkbox"?m(r=>({...r,[s]:C})):(m(r=>({...r,[s]:w})),p(r=>{if(r[s]){const l={...r};return delete l[s],l}return r}))},v=async n=>{if(n.preventDefault(),!N()){b.show("Please fix the errors in the form.","error");return}k(!0);try{const s=new FormData;s.append("name",o.name),o.icon&&s.append("icon",o.icon),s.append("is_active",o.is_active?"1":"0"),t&&o.remove_icon&&s.append("remove_icon","1"),await f(s),b.show(t?"Category updated!":"Category created!","success"),g()}catch(s){b.show(s.message||"Failed to submit","error")}finally{k(!1)}};return e.jsx(S,{open:a,onClose:g,title:t?"Edit Category":"Add New Category",size:"large",children:e.jsxs("form",{onSubmit:v,className:"flex flex-col gap-4 max-h-[70vh] overflow-y-auto",noValidate:!0,children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-semibold text-theme-text mb-1",children:["Category Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",name:"name",value:o.name,onChange:u,required:!0,maxLength:50,className:`w-full px-3 py-2 rounded-lg border transition-all duration-200 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 ${x.name?"border-red-300 bg-red-50 dark:bg-red-900/30 focus:ring-red-400 focus:border-red-400":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}`,placeholder:"Enter category name","aria-invalid":!!x.name,"aria-describedby":x.name?"name-error":void 0}),x.name&&e.jsxs("div",{id:"name-error",className:"text-red-500 text-xs mt-1 flex items-center gap-1",role:"alert",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),x.name]})]}),e.jsx(I,{id:"icon",name:"icon",accept:"image/*",required:!t,onChange:u,label:`Icon ${t?"(optional)":"(required)"}`,error:x.icon,maxSize:1*1024*1024}),t&&i?.icon&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("img",{src:B(i.icon),alt:"Current icon",className:"w-8 h-8 object-cover rounded"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",name:"remove_icon",checked:o.remove_icon,onChange:u,className:"w-4 h-4 text-primary-600 bg-white border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),"Remove current icon"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("input",{id:"is_active",name:"is_active",type:"checkbox",checked:o.is_active,onChange:u,className:"w-4 h-4 text-primary-600 bg-white border-gray-300 rounded focus:ring-primary-500 focus:ring-2"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active Category"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"(Inactive categories won't appear in product listings)"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:g,disabled:y,className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-all duration-200 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:y,className:"flex-1 py-2 px-4 rounded-lg font-semibold shadow-lg transition-all duration-200 bg-primary-600 hover:bg-primary-700 focus:bg-primary-800 text-white focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 disabled:opacity-60 flex items-center justify-center gap-2",children:[y&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),y?t?"Saving...":"Creating...":t?"Save Changes":"Create Category"]})]})]})})}function T({open:a,onClose:g,onConfirm:f,categoryName:i,loading:t}){return e.jsx(S,{open:a,onClose:g,title:"Delete Category",size:"medium",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete Category"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:i}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:g,disabled:t,className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-all duration-200 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:t,className:"flex-1 py-2 px-4 rounded-lg font-semibold shadow-lg transition-all duration-200 bg-red-600 hover:bg-red-700 focus:bg-red-800 text-white focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 disabled:opacity-60 flex items-center justify-center gap-2",children:[t&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),t?"Deleting...":"Delete"]})]})]})})}function G(){const{token:a}=A(),[g,f]=h.useState(!1),[i,t]=h.useState(null),[o,m]=h.useState(!1),[y,k]=h.useState(null),[x,p]=h.useState(!1),b=_(),{data:j,isLoading:N,error:u,refetch:v}=F({queryKey:["categories",a],queryFn:async()=>{if(!a||typeof a!="string"||a.length<=10)return[];const r=await E("/api/v1/manage-categories",{token:a});return(Array.isArray(r.data)?r.data:r.data?.data||[]).map(c=>({...c,is_active:c.is_active===!0||c.is_active===1||c.is_active==="1"}))}}),n=j||[],s=n,w=async r=>{await z("/api/v1/manage-categories",{token:a,data:r}),await v()},d=async r=>{await M(`/api/v1/manage-categories/${i.id}`,{token:a,data:r}),await v()},C=async()=>{p(!0);try{await D(`/api/v1/manage-categories/${y.id}`,{token:a}),b.show("Category deleted!","success"),m(!1),k(null),await v()}catch(r){b.show(r.message||"Failed to delete","error")}finally{p(!1)}},L=async r=>{try{await M(`/api/v1/manage-categories/${r.id}`,{token:a,data:{is_active:!r.is_active}}),await v()}catch(l){b.show(l.message||"Failed to update status","error")}};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 sm:py-8 px-1 sm:px-2 md:px-0",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-xl",children:e.jsx("svg",{className:"w-6 h-6 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Categories"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-normal text-lg sm:text-xl ml-2",children:"Management"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Organize products with categories and manage their visibility"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[n.length," ",n.length===1?"category":"categories"," total"]}),e.jsxs("button",{className:"px-4 py-2 rounded-lg font-semibold shadow-lg transition-all duration-200 bg-primary-600 hover:bg-primary-700 focus:bg-primary-800 text-white focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 flex items-center gap-2",onClick:()=>{t(null),f(!0)},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Category"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6",children:N?e.jsxs("div",{className:"flex flex-col items-center py-16",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary-500 mb-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Loading categories..."})]}):u?e.jsxs("div",{className:"flex flex-col items-center py-16",children:[e.jsx("svg",{className:"h-8 w-8 text-red-500 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-red-500 font-medium",children:u.message||u})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center py-16",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-gray-400 mb-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0A9 9 0 11.75 12a9 9 0 0117.25 0z"})}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium mb-2",children:"No categories found"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm",children:"Get started by creating your first category"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(r=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:r.icon?e.jsx("img",{src:B(r.icon),alt:r.name,className:"w-12 h-12 object-cover rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700",onError:l=>{try{l.target.onerror=null,l.target.style.display="none";const c=l.target.parentNode;c&&(c.innerHTML='<div class="w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-500 dark:text-gray-400">N/A</div>')}catch(c){console.warn("Error handling image load failure:",c)}}}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate mb-2",children:r.name}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("button",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all duration-200 ${r.is_active?"bg-green-100 text-green-700 focus:ring-green-400 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-600 focus:ring-gray-400 dark:bg-gray-700 dark:text-gray-300"}`,onClick:()=>L(r),title:"Toggle status",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),r.is_active?"Active":"Inactive"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex-1 px-3 py-1.5 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/30 dark:hover:bg-blue-800/40 text-blue-700 dark:text-blue-300 rounded-lg text-xs font-medium transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400",onClick:()=>{t(r),f(!0)},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3 inline mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 11l6 6M3 21h6a2 2 0 002-2v-6a2 2 0 00-2-2H3a2 2 0 00-2 2v6a2 2 0 002 2z"})}),"Edit"]}),e.jsxs("button",{className:"flex-1 px-3 py-1.5 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-800/40 text-red-700 dark:text-red-300 rounded-lg text-xs font-medium transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400",onClick:()=>{k(r),m(!0)},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3 inline mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),"Delete"]})]})]})]})},r.id))})}),e.jsx(H,{open:g,onClose:()=>f(!1),onSubmit:i?d:w,initialData:i,isEdit:!!i}),e.jsx(T,{open:o,onClose:()=>m(!1),onConfirm:C,categoryName:y?.name,loading:x})]})}export{G as default};
