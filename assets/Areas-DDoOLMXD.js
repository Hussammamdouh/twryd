import{u as P,r as t,a as E,j as e}from"./index-Cclg67os.js";import{g as B,p as T,a as q,d as R}from"./api-BUuAVsLY.js";import{M as V}from"./Modal-DoRxSVjK.js";import{C as Z}from"./ConfirmModal-Dok-e16l.js";function J({open:i,onClose:m,onSubmit:C,initialData:c,isEdit:h,governates:S}){const[n,y]=t.useState({name:"",governorate_id:"",polygon:[{lat:30.0444,lng:31.2357},{lat:30.0544,lng:31.2457},{lat:30.0644,lng:31.2557},{lat:30.0444,lng:31.2357}]}),[x,d]=t.useState(!1),[o,f]=t.useState({}),u=E();t.useEffect(()=>{i&&(y({name:c?.name||"",governorate_id:c?.governorate_id||"",polygon:c?.polygon||[{lat:30.0444,lng:31.2357},{lat:30.0544,lng:31.2457},{lat:30.0644,lng:31.2557},{lat:30.0444,lng:31.2357}]}),f({}))},[i,c]);const g=a=>{const{name:l,value:w}=a.target;y({...n,[l]:w}),f(v=>{if(v[l]){const b={...v};return delete b[l],b}return v})},k=()=>{const a={};return n.name.trim()||(a.name="Area name is required"),n.governorate_id||(a.governorate_id="Please select a governorate"),(!n.polygon||n.polygon.length<3)&&(a.polygon="At least 3 polygon points are required"),f(a),Object.keys(a).length===0},A=async a=>{if(a.preventDefault(),!!k()){d(!0);try{await C(n),u.show(h?"Area updated successfully!":"Area created successfully!","success"),m()}catch(l){u.show(l.message||"Failed to submit","error")}finally{d(!1)}}};return e.jsx(V,{open:i,onClose:m,title:h?"Edit Area":"Add New Area",size:"large",children:e.jsxs("form",{onSubmit:A,className:"flex flex-col gap-4 max-h-[70vh] overflow-y-auto",noValidate:!0,children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-semibold text-theme-text mb-1",children:["Area Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",name:"name",value:n.name,onChange:g,required:!0,maxLength:50,className:`w-full px-3 py-2 rounded-lg border transition-all duration-200 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 ${o.name?"border-red-300 bg-red-50 dark:bg-red-900/30 focus:ring-red-400 focus:border-red-400":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}`,placeholder:"Enter area name","aria-invalid":!!o.name,"aria-describedby":o.name?"name-error":void 0}),o.name&&e.jsxs("div",{id:"name-error",className:"text-red-500 text-xs mt-1 flex items-center gap-1",role:"alert",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),o.name]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"governorate_id",className:"block text-sm font-semibold text-theme-text mb-1",children:["Governorate ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"governorate_id",name:"governorate_id",value:n.governorate_id,onChange:g,required:!0,className:`w-full px-3 py-2 rounded-lg border transition-all duration-200 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 ${o.governorate_id?"border-red-300 bg-red-50 dark:bg-red-900/30 focus:ring-red-400 focus:border-red-400":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}`,"aria-invalid":!!o.governorate_id,"aria-describedby":o.governorate_id?"governorate-error":void 0,children:[e.jsx("option",{value:"",children:"Select Governorate"}),S.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),o.governorate_id&&e.jsxs("div",{id:"governorate-error",className:"text-red-500 text-xs mt-1 flex items-center gap-1",role:"alert",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),o.governorate_id]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-theme-text mb-1",children:["Polygon Coordinates ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Default coordinates are provided. For production, implement a map interface to set coordinates."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-2",children:"Current polygon points:"}),n.polygon.map((a,l)=>e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300 mb-1",children:["Point ",l+1,": ",a.lat.toFixed(4),", ",a.lng.toFixed(4)]},l))]}),o.polygon&&e.jsxs("div",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",role:"alert",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),o.polygon]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:m,disabled:x,className:"flex-1 py-2 px-4 rounded-lg font-semibold transition-all duration-200 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex-1 py-2 px-4 rounded-lg font-semibold shadow-lg transition-all duration-200 bg-primary-600 hover:bg-primary-700 focus:bg-primary-800 text-white focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 disabled:opacity-60 flex items-center justify-center gap-2",children:[x&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),x?h?"Saving...":"Creating...":h?"Save Changes":"Create Area"]})]})]})})}function Y(){const{token:i}=P(),[m,C]=t.useState([]),[c,h]=t.useState([]),[S,n]=t.useState(!1),[y,x]=t.useState(""),[d,o]=t.useState(""),[f,u]=t.useState(!1),[g,k]=t.useState(null),[A,a]=t.useState(!1),[l,w]=t.useState(null),[v,b]=t.useState(!1),[p,W]=t.useState(""),[N,L]=t.useState({}),M=E(),j=async r=>{n(!0),x("");try{const O=(await B("/api/v1/location/governorates",{token:i})).data?.data||[];h(O),r!==void 0&&W(r);let _={data:{data:[]}};r&&r!==""&&(_=await B(`/api/v1/location/governorates/${r}/areas`,{token:i,params:{per_page:50}})),C(_.data?.data||[])}catch(s){x(s.message||"Failed to load areas/governates"),M.show(s.message||"Failed to load areas/governates","error")}finally{n(!1)}};t.useEffect(()=>{i&&j("")},[i]);const z=r=>{const s=r.target.value;W(s),j(s)},D=async r=>{L(s=>({...s,add:!0}));try{await T("/api/v1/location/admin/areas",{token:i,data:r}),await j(p)}finally{L(s=>({...s,add:!1}))}},G=async r=>{L(s=>({...s,edit:!0}));try{await q(`/api/v1/location/admin/areas/${g.id}`,{token:i,data:r}),await j(p)}finally{L(s=>({...s,edit:!1}))}},$=async()=>{b(!0);try{await R(`/api/v1/location/admin/areas/${l.id}`,{token:i}),M.show("Area deleted successfully!","success"),a(!1),w(null),await j(p)}catch(r){M.show(r.message||"Failed to delete area","error")}finally{b(!1)}},F=t.useMemo(()=>m.filter(r=>!d||r.name&&r.name.toLowerCase().includes(d.toLowerCase())||r.governorate?.name&&r.governorate.name.toLowerCase().includes(d.toLowerCase())),[m,d]),H=r=>{o(r)};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 sm:py-8 px-1 sm:px-2 md:px-0",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-xl",children:e.jsxs("svg",{className:"w-6 h-6 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Areas"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-normal text-lg sm:text-xl ml-2",children:"Management"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Manage delivery areas and their geographic boundaries"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx("div",{className:"flex-1 w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsxs("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",d:"M21 21l-3.5-3.5"})]})}),e.jsx("input",{type:"text",placeholder:"Search areas by name or governorate...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:d,onChange:r=>H(r.target.value),"aria-label":"Search areas"})]})}),e.jsxs("select",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:p,onChange:z,"aria-label":"Filter by governorate",children:[e.jsx("option",{value:"",children:"All Governorates"}),c.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-semibold shadow-lg transition-all duration-200 bg-primary-600 hover:bg-primary-700 focus:bg-primary-800 text-white focus:outline-none focus:ring-2 focus:ring-primary-400 focus:ring-offset-2 disabled:opacity-60 flex items-center gap-2",onClick:()=>{k(null),u(!0)},disabled:N.add,children:N.add?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Area"]})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Governorate"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Polygon Points"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:S?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Loading areas..."})]})})}):y?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("svg",{className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-red-500 font-medium",children:y})]})})}):F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("svg",{className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:p===""?"Select a governorate to view areas":"No areas found"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm mt-1",children:p===""?"Choose a governorate from the dropdown above to see its areas":"Try adjusting your search or filters"})]})]})})}):F.map(r=>e.jsxs("tr",{className:"bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-300",children:r.governorate?.name||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-300",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900/30 dark:text-primary-300",children:[r.polygon?.length||0," points"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{k(r),u(!0)},disabled:N.edit,className:"p-2 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/30 dark:hover:bg-blue-800/40 text-blue-700 dark:text-blue-300 rounded-lg transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400",title:"Edit area","aria-label":"Edit area",children:e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M16.862 5.487a2.06 2.06 0 1 1 2.915 2.914l-9.193 9.193-3.06.34a.75.75 0 0 1-.83-.83l.34-3.06 9.193-9.193Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{onClick:()=>{w(r),a(!0)},disabled:N.delete,className:"p-2 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-800/40 text-red-700 dark:text-red-300 rounded-lg transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400",title:"Delete area","aria-label":"Delete area",children:e.jsxs("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12ZM9 7V5a3 3 0 0 1 6 0v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 11v6M14 11v6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})})]},r.id))})]})})}),e.jsx(J,{open:f,onClose:()=>u(!1),onSubmit:g?G:D,initialData:g,isEdit:!!g,governates:c}),e.jsx(Z,{open:A,title:"Delete Area",message:l?`Are you sure you want to delete "${l.name}"? This action cannot be undone.`:"",onConfirm:$,onCancel:()=>a(!1),loading:v})]})}export{Y as default};
