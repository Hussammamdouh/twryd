import{R as y,u as de,r as d,j as t}from"./index-BciHiggx.js";import{g as R,a as ue,p as pe,d as he}from"./api-BUuAVsLY.js";import{M as H}from"./Modal-ZBCWTlSA.js";import{F as me}from"./FileUpload-Ca9oY3IU.js";var G={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},z=y.createContext&&y.createContext(G),xe=["attr","size","title"];function fe(a,n){if(a==null)return{};var s=ge(a,n),r,i;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(a);for(i=0;i<p.length;i++)r=p[i],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(s[r]=a[r])}return s}function ge(a,n){if(a==null)return{};var s={};for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)){if(n.indexOf(r)>=0)continue;s[r]=a[r]}return s}function C(){return C=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},C.apply(this,arguments)}function q(a,n){var s=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),s.push.apply(s,r)}return s}function P(a){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?q(Object(s),!0).forEach(function(r){be(a,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):q(Object(s)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(s,r))})}return a}function be(a,n,s){return n=ye(n),n in a?Object.defineProperty(a,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[n]=s,a}function ye(a){var n=ve(a,"string");return typeof n=="symbol"?n:n+""}function ve(a,n){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var r=s.call(a,n);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(a)}function K(a){return a&&a.map((n,s)=>y.createElement(n.tag,P({key:s},n.attr),K(n.child)))}function N(a){return n=>y.createElement(je,C({attr:P({},a.attr)},n),K(a.child))}function je(a){var n=s=>{var{attr:r,size:i,title:p}=a,u=fe(a,xe),m=i||s.size||"1em",o;return s.className&&(o=s.className),a.className&&(o=(o?o+" ":"")+a.className),y.createElement("svg",C({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,r,u,{className:o,style:P(P({color:a.color||s.color},s.style),a.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),p&&y.createElement("title",null,p),a.children)};return z!==void 0?y.createElement(z.Consumer,null,s=>n(s)):n(G)}function Ne(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"},child:[]}]})(a)}function we(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"6",y:"4",width:"4",height:"16"},child:[]},{tag:"rect",attr:{x:"14",y:"4",width:"4",height:"16"},child:[]}]})(a)}function U(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"},child:[]}]})(a)}function Se(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(a)}function _e(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"},child:[]},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"},child:[]},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"},child:[]},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"},child:[]}]})(a)}function V(a){return N({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"},child:[]},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"},child:[]},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"},child:[]}]})(a)}const $={active:"bg-green-100 text-green-700 border-green-300",inactive:"bg-gray-100 text-gray-500 border-gray-300",suspended:"bg-red-100 text-red-700 border-red-300"};function Ce({open:a,onClose:n,onSubmit:s,initialData:r,loading:i,warehouses:p}){const[u,m]=d.useState(r||{name:"",type:"",phone:"",car_name:"",car_number:"",license_number:"",warehouse:"",status:"active",license_file:null});d.useEffect(()=>{a&&m(r||{name:"",type:"",phone:"",car_name:"",car_number:"",license_number:"",warehouse:"",status:"active",license_file:null})},[a,r]);const o=x=>{const{name:g,value:v,type:j,files:D}=x.target;m(w=>({...w,[g]:j==="file"?D[0]:v}))},f=x=>{x.preventDefault(),s(u)};return t.jsx(H,{open:a,onClose:n,title:r?"Edit Delivery Person":"Add New Delivery Person",children:t.jsxs("form",{onSubmit:f,className:"flex flex-col gap-4",children:[t.jsx("input",{name:"name",placeholder:"Full Name",value:u.name,onChange:o,className:"theme-input w-full px-3 py-2 rounded",required:!0}),t.jsx("input",{name:"type",placeholder:"Type (Driver, Delivery Person, etc.)",value:u.type,onChange:o,className:"theme-input w-full px-3 py-2 rounded",required:!0}),t.jsx("input",{name:"phone",placeholder:"Phone Number",value:u.phone,onChange:o,className:"theme-input w-full px-3 py-2 rounded",required:!0}),t.jsx("input",{name:"car_name",placeholder:"Car Name/Model",value:u.car_name,onChange:o,className:"theme-input w-full px-3 py-2 rounded"}),t.jsx("input",{name:"car_number",placeholder:"Car Number/Plate",value:u.car_number,onChange:o,className:"theme-input w-full px-3 py-2 rounded"}),t.jsx("input",{name:"license_number",placeholder:"License Number",value:u.license_number,onChange:o,className:"theme-input w-full px-3 py-2 rounded"}),t.jsxs("select",{name:"warehouse",value:u.warehouse,onChange:o,className:"theme-input w-full px-3 py-2 rounded",children:[t.jsx("option",{value:"",children:"Select Warehouse"}),p?.length>0?p.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id)):t.jsx("option",{value:"",disabled:!0,children:"No warehouses available"})]}),p?.length===0&&t.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"No warehouses found. Please create warehouses first in the Warehouses section."}),t.jsx(me,{name:"license_file",accept:".pdf,.jpg,.jpeg,.png",onChange:o,label:"License File",required:!1}),t.jsxs("select",{name:"status",value:u.status,onChange:o,className:"theme-input w-full px-3 py-2 rounded",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"suspended",children:"Suspended"})]}),t.jsx("button",{type:"submit",disabled:i,className:"theme-button w-full py-2 font-bold rounded transition disabled:opacity-60 mt-2 shadow",children:i?"Saving...":r?"Save Changes":"Add Delivery Person"})]})})}function Pe({open:a,onClose:n,onConfirm:s,driverName:r,loading:i}){return t.jsxs(H,{open:a,onClose:n,title:"Delete Delivery Person",children:[t.jsx("h3",{className:"text-xl font-bold mb-6 text-red-700 flex items-center gap-2",children:"Delete Delivery Person"}),t.jsxs("p",{className:"mb-6 text-theme-text",children:["Are you sure you want to delete ",t.jsx("span",{className:"font-semibold",children:r}),"?"]}),t.jsxs("div",{className:"flex gap-4 justify-end",children:[t.jsx("button",{onClick:n,className:"theme-button-secondary px-4 py-2 rounded",children:"Cancel"}),t.jsx("button",{onClick:s,disabled:i,className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-60 shadow",children:i?"Deleting...":"Delete"})]})]})}function Le(){const{token:a,user:n}=de(),[s,r]=d.useState([]),[i,p]=d.useState([]),[u,m]=d.useState(!1),[o,f]=d.useState(""),[x,g]=d.useState(!1),[v,j]=d.useState(null),[D,w]=d.useState(!1),[O,W]=d.useState(null),[Y,M]=d.useState(!1),[_,J]=d.useState(""),[k,Q]=d.useState(""),[F,X]=d.useState(""),[S,I]=d.useState(1),Z=async()=>{m(!0),f("");try{const e=await R("/api/supplier/shipping-drivers",{token:a});let c=[];Array.isArray(e.data)?c=e.data:e.data?.shipping_drivers&&(c=e.data.shipping_drivers),r(c)}catch(e){f(e.message||"Failed to load drivers")}finally{m(!1)}},ee=async()=>{try{const e=await R("/api/supplier/warehouses",{token:a}),c=Array.isArray(e.data)?e.data:e.data?.data||[];p(c)}catch{p([])}};d.useEffect(()=>{a&&(Z(),ee())},[a]);const L=4,T=s.filter(e=>{const c=!_||e.name?.toLowerCase().includes(_.toLowerCase())||e.phone?.includes(_),l=!k||String(e.warehouse)===String(k),b=!F||e.status===F;return c&&l&&b}),A=Math.ceil(T.length/L),B=T.slice((S-1)*L,S*L),te=()=>{j(null),g(!0)},ae=e=>{j(e),g(!0)},ne=e=>{W(e),w(!0)},se=async e=>{m(!0);const c=s;if(v){r(s.map(l=>l.id===v.id?{...l,...e}:l));try{const l=new FormData;l.append("name",e.name),l.append("type",e.type),l.append("phone",e.phone),l.append("car_name",e.car_name),l.append("car_number",e.car_number),l.append("license_number",e.license_number),n?.id&&l.append("supplier_id",n.id),e.license_file&&l.append("license_file",e.license_file),e.status&&l.append("status",e.status),await ue(`/api/supplier/shipping-drivers/${v.id}`,{token:a,data:l}),g(!1),j(null)}catch(l){r(c),f(l.message||"Failed to save driver")}finally{m(!1)}}else{const l=Math.random().toString(36).slice(2),b={...e,id:l};r([b,...s]);try{const h=new FormData;h.append("name",e.name),h.append("type",e.type),h.append("phone",e.phone),h.append("car_name",e.car_name),h.append("car_number",e.car_number),h.append("license_number",e.license_number),n?.id&&h.append("supplier_id",n.id),e.license_file&&h.append("license_file",e.license_file),e.status&&h.append("status",e.status);const ie=await pe("/api/supplier/shipping-drivers",{token:a,data:h});r(oe=>[ie.data,...oe.filter(ce=>ce.id!==l)]),g(!1),j(null)}catch(h){r(c),f(h.message||"Failed to save driver")}finally{m(!1)}}},re=async()=>{M(!0);const e=s;r(s.filter(c=>c.id!==O.id));try{await he(`/api/supplier/shipping-drivers/${O.id}`,{token:a}),w(!1),W(null)}catch(c){r(e),f(c.message||"Failed to delete driver")}finally{M(!1)}},E=(e,c)=>{r(l=>l.map(b=>b.id===e.id?{...b,status:c}:b))},le=i.map(e=>({id:e.id,name:e.name}));return t.jsxs("div",{className:"w-full max-w-6xl mx-auto py-10 px-2 flex flex-col gap-6 animate-fadeIn",children:[t.jsxs("h1",{className:"text-3xl font-extrabold mb-2 text-primary-700 tracking-tight drop-shadow flex items-center gap-3",children:[t.jsx(V,{className:"text-primary-400"})," Delivery Personnel"]}),t.jsxs("div",{className:"flex flex-wrap gap-3 mb-2 items-center theme-card p-4",children:[t.jsxs("div",{className:"flex items-center bg-theme-surface rounded-lg px-2 py-1 w-full sm:w-auto",children:[t.jsx(Se,{className:"text-theme-text-muted mr-2"}),t.jsx("input",{type:"text",placeholder:"Search by name or phone number...",value:_,onChange:e=>J(e.target.value),className:"bg-transparent outline-none px-2 py-2 min-w-[180px] w-full sm:w-auto focus:ring-2 focus:ring-primary-400 rounded text-theme-text","aria-label":"Search delivery personnel"})]}),t.jsxs("select",{value:k,onChange:e=>Q(e.target.value),className:"theme-input px-4 py-2 rounded-lg","aria-label":"Filter by warehouse",children:[t.jsx("option",{value:"",children:"All Warehouses"}),le.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{value:F,onChange:e=>X(e.target.value),className:"theme-input px-4 py-2 rounded-lg","aria-label":"Filter by status",children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"}),t.jsx("option",{value:"suspended",children:"Suspended"})]}),t.jsxs("button",{onClick:te,className:"theme-button ml-auto flex items-center gap-2 px-5 py-2 rounded-lg font-bold shadow",children:[t.jsx(V,{})," Add New Delivery Person"]})]}),t.jsxs("div",{className:"theme-card p-4 sm:p-6 overflow-x-auto",children:[o&&t.jsx("div",{className:"text-red-600 font-bold mb-4",children:o}),u?t.jsx("div",{className:"flex justify-center py-12 text-primary-600 font-bold text-lg",children:"Loading..."}):t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"theme-table-header text-primary-700",children:[t.jsx("th",{className:"py-3 px-3 text-left font-bold",children:"Agent Name"}),t.jsx("th",{className:"py-3 px-3 text-left font-bold",children:"Phone Number"}),t.jsx("th",{className:"py-3 px-3 text-left font-bold",children:"Vehicle Info"}),t.jsx("th",{className:"py-3 px-3 text-left font-bold",children:"Assigned Warehouse"}),t.jsx("th",{className:"py-3 px-3 text-left font-bold",children:"Status"}),t.jsx("th",{className:"py-3 px-3 text-right font-bold",children:"Actions"})]})}),t.jsxs("tbody",{children:[B.map(e=>t.jsxs("tr",{className:"border-b border-theme-border last:border-b-0 hover:bg-theme-surface transition",children:[t.jsx("td",{className:"py-3 px-3 font-semibold text-theme-text",children:e.name}),t.jsx("td",{className:"py-3 px-3 text-theme-text",children:e.phone}),t.jsx("td",{className:"py-3 px-3 text-theme-text",children:[e.car_name,e.car_number].filter(Boolean).join(", ")}),t.jsx("td",{className:"py-3 px-3 text-theme-text",children:i.find(c=>c.id===e.warehouse)?.name||e.warehouse||"Not Assigned"}),t.jsx("td",{className:"py-3 px-3",children:t.jsx("span",{className:`inline-block px-3 py-1 rounded-full border text-xs font-bold shadow-sm ${$[e.status]||$.inactive} dark:bg-opacity-30`,children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):"Inactive"})}),t.jsxs("td",{className:"py-3 px-3 text-right flex gap-2 justify-end items-center",children:[t.jsx("button",{onClick:()=>ae(e),title:"Edit",className:"p-2 rounded-full hover:bg-primary-100 text-primary-600 transition","aria-label":"Edit",children:t.jsx(Ne,{})}),t.jsx("button",{onClick:()=>ne(e),title:"Delete",className:"p-2 rounded-full hover:bg-red-100 text-red-600 transition","aria-label":"Delete",children:t.jsx(_e,{})}),e.status==="active"&&t.jsx("button",{onClick:()=>E(e,"suspended"),title:"Suspend",className:"p-2 rounded-full hover:bg-orange-100 text-orange-500 transition","aria-label":"Suspend",children:t.jsx(we,{})}),e.status==="inactive"&&t.jsx("button",{onClick:()=>E(e,"active"),title:"Reactivate",className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition","aria-label":"Reactivate",children:t.jsx(U,{})}),e.status==="suspended"&&t.jsx("button",{onClick:()=>E(e,"active"),title:"Reactivate",className:"p-2 rounded-full hover:bg-green-100 text-green-600 transition","aria-label":"Reactivate",children:t.jsx(U,{})})]})]},e.id)),B.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"py-12 text-center text-theme-text-muted",children:"No delivery personnel found."})})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[t.jsx("button",{onClick:()=>I(e=>Math.max(1,e-1)),disabled:S===1,className:"theme-button-secondary px-5 py-2 rounded-lg font-bold disabled:opacity-60 shadow",children:"Previous"}),t.jsxs("span",{className:"text-base font-semibold text-theme-text",children:["Page ",S," of ",A]}),t.jsx("button",{onClick:()=>I(e=>Math.min(A,e+1)),disabled:S===A,className:"theme-button px-5 py-2 rounded-lg font-bold disabled:opacity-60 shadow",children:"Next"})]})]}),t.jsx(Ce,{open:x,onClose:()=>g(!1),onSubmit:se,initialData:v,loading:u,warehouses:i}),t.jsx(Pe,{open:D,onClose:()=>w(!1),onConfirm:re,driverName:O?.name,loading:Y})]})}export{Le as default};
