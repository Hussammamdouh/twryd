import{r as c,u as S,a as _,j as e}from"./index-BBFhNgLA.js";import{g as v}from"./api-BUuAVsLY.js";import{L as I}from"./ErrorBoundary-C7XI_3jQ.js";import{M}from"./Modal-BllzMBoT.js";const j=a=>{if(!a)return"-";try{return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"-"}},l=a=>a?parseFloat(a).toFixed(2):"0.00",F=(a,h)=>{const r=new Date,g=new Date(h);return a==="paid"?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",children:"Paid"}):a==="overdue"?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:"Overdue"}):g<r?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",children:"Overdue"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Pending"})};function B(){const[a,h]=c.useState([]),[r,g]=c.useState(null),[x,w]=c.useState([]),[b,N]=c.useState(!1),[k,f]=c.useState(!1),{token:p}=S(),y=_(),D=async()=>{try{N(!0);const t=await v("/api/client/installments",{token:p});console.log("Client Installments API Response:",t);const s=t.orders||t.data?.orders||t.data||[];console.log("Processed orders data:",s),h(s)}catch(t){console.error("Failed to load orders:",t.message),y.show("Failed to load orders","error")}finally{N(!1)}},O=async t=>{try{const s=await v(`/api/client/installments/order/${t}`,{token:p});console.log("Client Installments Detail API Response:",s);const n=s.installments||s.data?.installments||s.data||[];console.log("Processed installments data:",n),w(n)}catch(s){console.error("Failed to load installments:",s.message),y.show("Failed to load installments","error")}},A=t=>{g(t),O(t.id),f(!0)},u=c.useMemo(()=>{let t=a.length,s=0,n=0,m=0,o=0;return a.forEach(d=>{n+=parseFloat(d.initial_payment)||0,d.installments&&d.installments.length>0?d.installments.forEach(i=>{s+=parseFloat(i.amount)||0,i.status==="paid"?n+=parseFloat(i.amount)||0:i.status==="overdue"||new Date(i.due_date)<new Date?o+=parseFloat(i.amount)||0:m+=parseFloat(i.amount)||0}):m+=parseFloat(d.remaining_amount)||0}),{totalOrders:t,totalAmount:s,paidAmount:n,pendingAmount:m,overdueAmount:o}},[a]);return c.useEffect(()=>{p&&D()},[p]),b?e.jsx("div",{className:"min-h-screen bg-theme-bg p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(I,{type:"dashboard"})})}):e.jsx("div",{className:"min-h-screen bg-theme-bg p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-theme-text mb-2",children:"My Installments"}),e.jsx("p",{className:"text-theme-text-secondary",children:"View and track your installment plans for orders"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-secondary",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-theme-text",children:u.totalOrders})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-secondary",children:"Paid Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$",l(u.paidAmount)]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-secondary",children:"Pending Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:["$",l(u.pendingAmount)]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-secondary",children:"Overdue Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:["$",l(u.overdueAmount)]})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm border border-theme-border",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-theme-border",children:[e.jsx("h2",{className:"text-lg font-semibold text-theme-text",children:"Orders with Installments"}),e.jsx("p",{className:"text-sm text-theme-text-secondary mt-1",children:"View your orders that have installment plans"})]}),a.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-theme-text-muted mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("h3",{className:"text-lg font-medium text-theme-text mb-2",children:"No installment orders"}),e.jsx("p",{className:"text-theme-text-secondary",children:"You don't have any orders with installment plans at the moment."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-theme-border",children:[e.jsx("thead",{className:"bg-theme-surface",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Order Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Installment Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-theme-border",children:a.map(t=>{const s=t.installments||[],n=s.length,m=s.filter(d=>d.status==="paid").length,o=s.filter(d=>d.status==="overdue"||new Date(d.due_date)<new Date).length;return e.jsxs("tr",{className:"hover:bg-theme-surface transition-colors duration-200",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-theme-text",children:["#",t.order_number||t.id]}),e.jsx("div",{className:"text-sm text-theme-text-secondary",children:t.status||"Pending"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-theme-text",children:t.supplier?.name||`Supplier #${t.supplier_id?.slice(0,8)}`}),e.jsx("div",{className:"text-sm text-theme-text-secondary",children:t.supplier?.email||"Email not available"})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-theme-text",children:["$",l(t.total)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-theme-text-secondary",children:j(t.created_at)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-theme-text",children:[m,"/",n," Paid"]}),o>0&&e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400",children:[o," Overdue"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>A(t),className:"text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300",children:"View Details"})})]},t.id)})})]})})]}),e.jsx(M,{open:k,onClose:()=>f(!1),title:`Installment Details - Order #${r?.order_number||r?.id}`,children:x.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-theme-text-secondary",children:"No installments found for this order."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-theme-surface rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-text mb-2",children:"Order Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Supplier:"}),e.jsx("span",{className:"ml-2 text-theme-text",children:r?.supplier?.name||`Supplier #${r?.supplier_id?.slice(0,8)}`})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Total Amount:"}),e.jsxs("span",{className:"ml-2 text-theme-text",children:["$",l(r?.total)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Initial Payment:"}),e.jsxs("span",{className:"ml-2 text-theme-text",children:["$",l(r?.initial_payment)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Remaining Amount:"}),e.jsxs("span",{className:"ml-2 text-theme-text",children:["$",l(r?.remaining_amount)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Order Date:"}),e.jsx("span",{className:"ml-2 text-theme-text",children:j(r?.created_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Status:"}),e.jsx("span",{className:"ml-2 text-theme-text",children:r?.status||"Pending"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-theme-border",children:[e.jsx("thead",{className:"bg-theme-surface",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Installment #"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Due Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-theme-text-secondary uppercase tracking-wider",children:"Paid Date"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-theme-border",children:x.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-theme-text",children:s+1}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-theme-text",children:j(t.due_date)}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-theme-text",children:["$",l(t.amount)]}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:F(t.status,t.due_date)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-theme-text-secondary",children:t.paid_at?j(t.paid_at):"-"})]},t.id))})]})}),e.jsx("div",{className:"bg-theme-surface rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$",l(x.filter(t=>t.status==="paid").reduce((t,s)=>t+parseFloat(s.amount||0),0))]}),e.jsx("div",{className:"text-theme-text-secondary",children:"Paid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:["$",l(x.filter(t=>t.status!=="paid"&&new Date(t.due_date)>=new Date).reduce((t,s)=>t+parseFloat(s.amount||0),0))]}),e.jsx("div",{className:"text-theme-text-secondary",children:"Pending"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:["$",l(x.filter(t=>t.status==="overdue"||new Date(t.due_date)<new Date).reduce((t,s)=>t+parseFloat(s.amount||0),0))]}),e.jsx("div",{className:"text-theme-text-secondary",children:"Overdue"})]})]})})]})})]})})}export{B as default};
