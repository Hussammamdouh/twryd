import{r as a,u as S,a as _,j as e}from"./index-BciHiggx.js";import{S as B}from"./StatusBadge-CMhdMN1J.js";import{a as M,d as $,g as F}from"./api-BUuAVsLY.js";import{C as U}from"./ConfirmActionModal-CiPUw9AP.js";import{S as A}from"./Spinner-DWZXuFTn.js";import{M as P}from"./Modal-ZBCWTlSA.js";import{P as W}from"./Pagination-BGThXI18.js";import{u as q}from"./Topbar-F56iDE0U.js";import"./ThemeToggle-D9MzFKys.js";function O({open:f,client:d,onClose:y,onSuccess:v}){const[u,g]=a.useState(""),[n,c]=a.useState(!1),[p,m]=a.useState(""),{token:x}=S(),b=_();a.useEffect(()=>{d&&g(d.default_discount?.toString()||"")},[d]);const j=async h=>{if(h.preventDefault(),!u||u<0||u>100){m("Please enter a valid discount percentage (0-100)");return}c(!0),m("");try{await M(`/api/supplier-management/clients/${d.id}/default-discount`,{data:{default_discount:parseInt(u)},token:x}),b.show("Discount updated successfully","success"),y(),v?.()}catch(i){m(i.message||"Failed to update discount"),b.show(i.message||"Failed to update discount","error")}finally{c(!1)}},k=()=>{g(""),m(""),y()};if(!d)return null;const N=d.client||d;return e.jsx(P,{open:f,onClose:k,title:"Edit Client Discount",children:e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:j,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-theme-text mb-1 font-medium",children:"Client"}),e.jsxs("div",{className:"px-4 py-2 bg-theme-surface border border-theme-border rounded text-theme-text",children:[N.name||N.company_name||"N/A"," (",N.email||N.client_email||N.contact||"No email",")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-theme-text mb-1 font-medium",children:"Discount Percentage"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",className:`theme-input w-full px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-primary-400 ${p?"border-red-400":""}`,placeholder:"Enter discount percentage (0-100)",value:u,onChange:h=>g(h.target.value),disabled:n,required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-theme-text-secondary text-sm",children:"%"})})]})]}),p&&e.jsx("div",{className:"text-red-500 text-sm",role:"alert",children:p}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"theme-button-secondary px-4 py-2 rounded font-semibold focus:outline-none",onClick:k,disabled:n,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"theme-button px-4 py-2 rounded font-semibold shadow flex items-center gap-2 focus:outline-none",disabled:n,children:[n&&e.jsx(A,{size:16,color:"border-white"}),"Update Discount"]})]})]})})}const L=f=>{if(!f)return"-";try{return new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return"-"}};function V({clients:f,loading:d,onAction:y,onAdd:v,onRemoveDiscount:u,recentlyUpdated:g={},actionResult:n={},rowLoading:c={}}){const{token:p}=S(),[m,x]=a.useState({open:!1,type:"",client:null}),[b,j]=a.useState({open:!1,client:null}),k=_(),N=async(t,o)=>{try{t==="delete"&&(await $(`/api/supplier-management/clients/${o.id}/default-discount`,{token:p}),k.show("Discount removed successfully","success")),y?.()}catch(w){k.show(w.message||"Action failed","error")}finally{x({open:!1,type:"",client:null})}},h=()=>x({open:!1,type:"",client:null}),i=t=>j({open:!0,client:t}),l=()=>j({open:!1,client:null});return d?e.jsx("div",{className:"flex justify-center py-12 text-gray-500",children:e.jsx(A,{size:24})}):!f||f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400 gap-4 animate-fade-in",children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-blue-200 dark:text-blue-900",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8c-1.657 0-3 1.343-3 3 0 1.657 1.343 3 3 3s3-1.343 3-3c0-1.657-1.343-3-3-3zm0 9c-4.418 0-8-1.79-8-4V7a4 4 0 014-4h8a4 4 0 014 4v6c0 2.21-3.582 4-8 4z"})}),e.jsx("div",{className:"text-lg font-semibold",children:"No clients found."}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 focus:bg-blue-800 text-white rounded-lg font-bold shadow focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 transition-all duration-150",onClick:v,children:"+ Add New Discount"})]}):e.jsxs("div",{className:"overflow-x-auto rounded-lg shadow bg-white dark:bg-gray-900",children:[e.jsxs("table",{className:"min-w-full text-sm md:table bg-white dark:bg-gray-900 rounded-lg shadow-md",role:"table","aria-label":"Client Discounts Table",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-200",role:"rowgroup",children:e.jsxs("tr",{className:"h-12",role:"row",children:[e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Client Name"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Discount Percentage"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Start Date"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Expiry Date"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Status"}),e.jsx("th",{className:"px-4 md:px-6 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-700",role:"columnheader",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900",role:"rowgroup",children:f.map(t=>{const o=t.client||t;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 transition-colors duration-300 ${g[t.id]?n[t.id]==="success"?"ring-2 ring-green-400 bg-green-50 dark:bg-green-900/20":"ring-2 ring-red-400 bg-red-50 dark:bg-red-900/20":""}`,role:"row",tabIndex:0,"aria-label":`Client: ${o.name||o.company_name||"N/A"}, Email: ${o.email||o.client_email||o.contact||"No email"}`,children:[e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.name||o.company_name||"N/A"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-300 text-xs",children:o.email||o.client_email||o.contact||"No email"})]})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:t.default_discount?`${t.default_discount}%`:"No discount"}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:L(t.discount_start_date||t.created_at)}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100",children:L(t.discount_expiry_date)}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsx(B,{status:t.default_discount&&t.default_discount>0?"active":"inactive","aria-label":t.default_discount&&t.default_discount>0?"Active":"Inactive"})}),e.jsxs("td",{className:"px-4 md:px-6 py-4 flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 rounded shadow text-xs font-bold hover:bg-blue-200 dark:hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-colors duration-150",onClick:()=>i(t),disabled:c[t.id],tabIndex:0,"aria-label":`Edit discount for ${o.name||o.company_name||"N/A"}`,children:"Edit"}),e.jsx("button",{className:"px-3 py-1 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded shadow text-xs font-bold hover:bg-red-200 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 transition-colors duration-150",onClick:()=>u(t),disabled:c[t.id],tabIndex:0,"aria-label":`Remove discount for ${o.name||o.company_name||"N/A"}`,children:c[t.id]?e.jsx("svg",{className:"w-4 h-4 animate-spin text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):"Delete"}),n[t.id]==="success"&&!c[t.id]&&e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),n[t.id]==="error"&&!c[t.id]&&e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]},t.id)})})]}),e.jsx(U,{isOpen:m.open,onClose:h,onConfirm:()=>N(m.type,m.client),title:"Remove Discount",message:"Are you sure you want to remove this client's discount? This action cannot be undone.",confirmText:"Remove Discount",confirmColor:"red",loading:c[m.client?.id]}),e.jsx(O,{open:b.open,client:b.client,onClose:l,onSuccess:()=>{l(),y?.()}})]})}function H({open:f,onClose:d,onSuccess:y,clients:v}){const[u,g]=a.useState(""),[n,c]=a.useState(""),[p,m]=a.useState(!1),[x,b]=a.useState(""),{token:j}=S(),k=_(),N=async i=>{if(i.preventDefault(),!u){b("Please select a client");return}if(!n||n<0||n>100){b("Please enter a valid discount percentage (0-100)");return}m(!0),b("");try{await M(`/api/supplier-management/clients/${u}/default-discount`,{data:{default_discount:parseInt(n)},token:j}),k.show("Discount added successfully","success"),g(""),c(""),d(),y?.()}catch(l){b(l.message||"Failed to add discount"),k.show(l.message||"Failed to add discount","error")}finally{m(!1)}},h=()=>{g(""),c(""),b(""),d()};return e.jsx(P,{open:f,onClose:h,title:"Add New Discount",children:e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:N,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-theme-text mb-1 font-medium",children:"Select Client"}),e.jsxs("select",{className:`theme-input w-full px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-primary-400 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 ${x&&!u?"border-red-400":""}`,value:u,onChange:i=>g(i.target.value),disabled:p,required:!0,children:[e.jsx("option",{value:"",children:"Choose a client..."}),v?.length>0?v.map(i=>{const l=i.client||i,t=l.name||l.company_name||"Unknown Client",o=l.email||l.client_email||l.contact||"No email";return e.jsxs("option",{value:i.id,children:[t," (",o,")"]},i.id)}):e.jsx("option",{value:"",disabled:!0,children:"No clients available"})]}),v?.length===0&&e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 mt-1",children:"No clients found. Please invite clients first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-theme-text mb-1 font-medium",children:"Discount Percentage"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",className:`theme-input w-full px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-primary-400 ${x&&!n?"border-red-400":""}`,placeholder:"Enter discount percentage (0-100)",value:n,onChange:i=>c(i.target.value),disabled:p,required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-theme-text-secondary text-sm",children:"%"})})]})]}),x&&e.jsx("div",{className:"text-red-500 text-sm",role:"alert",children:x}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"theme-button-secondary px-4 py-2 rounded font-semibold focus:outline-none",onClick:h,disabled:p,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"theme-button px-4 py-2 rounded font-semibold shadow flex items-center gap-2 focus:outline-none",disabled:p,children:[p&&e.jsx(A,{size:16,color:"border-white"}),"Add Discount"]})]})]})})}function ae(){const[f,d]=a.useState(!1),[y,v]=a.useState([]),[u,g]=a.useState(!1),[n,c]=a.useState(1),[p,m]=a.useState(1),[x,b]=a.useState(""),[j,k]=a.useState(""),[N,h]=a.useState({}),[i,l]=a.useState({}),[t,o]=a.useState({}),{token:w}=S(),{sidebarCollapsed:R}=q(),C=async(r=n)=>{g(!0);try{const s=await F(`/api/supplier/invitations/clients?per_page=10&paginated=true&page=${r}`,{token:w}),D=s.data?.clients?.data||s.data?.clients||[];v(D),m(s.data?.clients?.last_page||1)}catch(s){console.error("Failed to load clients:",s.message)}finally{g(!1)}};a.useEffect(()=>{w&&C(n)},[w,n]);const T=a.useMemo(()=>y.filter(r=>{const s=r.name||r.company_name||"",D=r.email||"",z=!x||s.toLowerCase().includes(x.toLowerCase())||D.toLowerCase().includes(x.toLowerCase()),E=r.default_discount&&r.default_discount>0;return z&&(!j||j==="active"&&E||j==="inactive"&&!E)}),[y,x,j]),I=async r=>{o(s=>({...s,[r.id]:!0}));try{await $(`/api/supplier-management/clients/${r.id}/default-discount`,{token:w}),h(s=>({...s,[r.id]:!0})),l(s=>({...s,[r.id]:"success"})),setTimeout(()=>{h(s=>({...s,[r.id]:!1})),l(s=>({...s,[r.id]:void 0}))},2e3),C(n)}catch{h(s=>({...s,[r.id]:!0})),l(s=>({...s,[r.id]:"error"})),setTimeout(()=>{h(s=>({...s,[r.id]:!1})),l(s=>({...s,[r.id]:void 0}))},2e3)}finally{o(s=>({...s,[r.id]:!1}))}};return e.jsxs("div",{className:"min-h-screen bg-theme-bg",children:[e.jsx("main",{className:`pt-20 pr-8 transition-all duration-300 ${R?"pl-20":"pl-64"}`,children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx(V,{clients:T,loading:u,onAction:C,onAdd:()=>d(!0),onRemoveDiscount:I,recentlyUpdated:N,actionResult:i,rowLoading:t}),e.jsx(W,{page:n,totalPages:p,onPageChange:c})]})}),e.jsx(H,{open:f,onClose:()=>d(!1),onSuccess:C,clients:y})]})}export{ae as default};
