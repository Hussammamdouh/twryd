import{k as u,u as h,b as x,a as g,r as c,j as e}from"./index-BBFhNgLA.js";import{p}from"./api-BUuAVsLY.js";function j(){const{token:n}=u(),{token:s,user:i}=h(),o=x(),a=g(),[m,l]=c.useState(!0),[d,r]=c.useState(null);return c.useEffect(()=>{(async()=>{if(console.log("InvitationHandler mounted with token:",n),console.log("Auth token present:",!!s),console.log("User present:",!!i),console.log("User role:",i?.role),!n){r("Invalid invitation link"),l(!1);return}if(!s||!i){console.log("User not logged in, redirecting to login with invitation token"),o(`/login-client?invitation=${n}`);return}if(i.role!=="client"){r("Only clients can accept supplier invitations"),l(!1);return}try{l(!0),console.log("Attempting to accept invitation with token:",n),console.log("Auth token:",s?"Present":"Missing");const t=await p("/api/client/invitations/accept",{token:s,data:{token:n}});console.log("Invitation accepted successfully:",t),a.show("Invitation accepted successfully!","success"),setTimeout(()=>{o("/client/dashboard/invitations")},1500)}catch(t){console.error("Error accepting invitation:",t),t.message.includes("Session expired")||t.message.includes("401")||t.message.includes("403")?(r("Your session has expired. Please log in again to accept the invitation."),a.show("Session expired. Please log in again.","error")):t.message.includes("Invalid")||t.message.includes("not found")?(r("This invitation link is invalid or has expired. Please contact the supplier for a new invitation."),a.show("Invalid or expired invitation link","error")):(r(t.message||"Failed to accept invitation"),a.show(t.message||"Failed to accept invitation","error")),l(!1)}})()},[n,s,i,o,a]),m?e.jsx("div",{className:"min-h-screen bg-theme-bg flex items-center justify-center",children:e.jsx("div",{className:"theme-card rounded-2xl shadow-xl p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-theme-text mb-2",children:"Processing Invitation"}),e.jsx("p",{className:"text-theme-text-secondary mb-4",children:"Please wait while we process your invitation..."}),n&&e.jsxs("div",{className:"text-xs text-theme-text-muted bg-theme-surface p-2 rounded",children:[e.jsx("strong",{children:"Debug:"})," Token: ",n.substring(0,20),"..."]})]})})}):d?e.jsx("div",{className:"min-h-screen bg-theme-bg flex items-center justify-center",children:e.jsx("div",{className:"theme-card rounded-2xl shadow-xl p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-theme-text mb-2",children:"Invitation Error"}),e.jsx("p",{className:"text-theme-text-secondary mb-6",children:d}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>o("/"),className:"theme-button w-full px-4 py-2 font-semibold rounded-lg transition-colors",children:"Go to Home"}),e.jsx("button",{onClick:()=>o("/login-client"),className:"theme-button-secondary w-full px-4 py-2 font-semibold rounded-lg transition-colors",children:"Login as Client"})]})]})})}):null}export{j as default};
