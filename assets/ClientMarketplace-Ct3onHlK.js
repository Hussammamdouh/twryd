import{u as M,a as F,b as B,D,r as a,j as r}from"./index-BBFhNgLA.js";import{g as m,p as H}from"./api-BUuAVsLY.js";import{S as R}from"./Spinner-DiswAH3X.js";function V(){const{token:i}=M(),d=F(),N=B(),[S,l]=D(),[y,x]=a.useState([]),[C,f]=a.useState([]),[c,b]=a.useState([]),[_,j]=a.useState(!0),[v,k]=a.useState({}),[o,h]=a.useState(S.get("supplier")||""),[g,P]=a.useState(""),[u,L]=a.useState(""),[n,A]=a.useState("newest");a.useEffect(()=>{m("/api/v1/categories",{token:i}).then(e=>f(e.data||e.data?.data||[])).catch(()=>f([]))},[i]),a.useEffect(()=>{m("/api/client/invitations/suppliers",{token:i}).then(e=>b(e.data?.suppliers||[])).catch(()=>b([]))},[i]),a.useEffect(()=>{o&&c.length>0&&(c.some(t=>(t.id||t.supplier_id)?.toString()===o.toString())||(h(""),l({}),d.show("You do not have access to this supplier.","warning")))},[o,c]),a.useEffect(()=>{j(!0);const e=[];o&&e.push(`supplier_id=${encodeURIComponent(o)}`),g&&e.push(`category_id=${encodeURIComponent(g)}`),u&&e.push(`search=${encodeURIComponent(u)}`);const s=`/api/client-management/products${e.length?`?${e.join("&")}`:""}`;m(s,{token:i}).then(p=>{x(p.data?.products||p.data||[])}).catch(p=>{p?.response?.data?.message?.includes("Access denied")?(d.show("You do not have access to this supplier's products.","error"),h(""),l({}),x([])):x([])}).finally(()=>j(!1))},[i,o,g,u]);const w=a.useMemo(()=>{let e=[...y];return n==="newest"?e.sort((t,s)=>new Date(s.created_at)-new Date(t.created_at)):n==="price-asc"?e.sort((t,s)=>t.price-s.price):n==="price-desc"?e.sort((t,s)=>s.price-t.price):n==="discount-desc"&&e.sort((t,s)=>(s.discount||0)-(t.discount||0)),e},[y,n]),$=e=>{N(`/client/dashboard/product/${e.id}`)},z=e=>{h(e),l(e?{supplier:e}:{})},E=async e=>{k(t=>({...t,[e.id]:!0}));try{await H("/api/client/cart/items",{token:i,data:{product_id:e.id,quantity:1}}),d.show("Added to cart!","success")}catch(t){d.show(t.message||"Failed to add to cart","error")}finally{k(t=>({...t,[e.id]:!1}))}};return r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3",children:[r.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-xl",children:r.jsx("svg",{className:"w-6 h-6 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7V6a2 2 0 012-2h14a2 2 0 012 2v1M5 7h14l1 5H4l1-5zm2 8a2 2 0 104 0 2 2 0 00-4 0zm10 0a2 2 0 104 0 2 2 0 00-4 0z"})})}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-900 dark:text-white",children:"Marketplace"}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-normal text-lg sm:text-xl ml-2",children:"Browse Products"})]})]}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Explore products from your connected suppliers and add them to your cart."})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6 flex flex-wrap gap-4 items-center",children:[r.jsxs("select",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:o,onChange:e=>z(e.target.value),children:[r.jsx("option",{value:"",children:"All Suppliers"}),c.map(e=>r.jsx("option",{value:e.id||e.supplier_id,children:e.name||e.supplier?.name},e.id||e.supplier_id))]}),r.jsxs("select",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:g,onChange:e=>P(e.target.value),children:[r.jsx("option",{value:"",children:"All Categories"}),C.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),r.jsx("input",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200 flex-1 min-w-[200px]",placeholder:"Search products...",value:u,onChange:e=>L(e.target.value)}),r.jsxs("select",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:n,onChange:e=>A(e.target.value),children:[r.jsx("option",{value:"newest",children:"Newest"}),r.jsx("option",{value:"price-asc",children:"Price: Low to High"}),r.jsx("option",{value:"price-desc",children:"Price: High to Low"}),r.jsx("option",{value:"discount-desc",children:"Biggest Discount"})]})]}),_?r.jsx("div",{className:"flex justify-center py-24",children:r.jsx(R,{size:32})}):w.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center py-24",children:[r.jsx("svg",{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7V6a2 2 0 012-2h14a2 2 0 012 2v1M5 7h14l1 5H4l1-5zm2 8a2 2 0 104 0 2 2 0 00-4 0zm10 0a2 2 0 104 0 2 2 0 00-4 0z"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2",children:"No products found"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Try adjusting your filters or search terms."})]}):r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:w.map(e=>r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 flex flex-col relative cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>$(e),children:[e.discount>0&&r.jsxs("span",{className:"absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded",children:["-",e.discount,"% Off"]}),r.jsx("div",{className:"h-36 flex items-center justify-center mb-4 bg-gray-100 dark:bg-gray-700 rounded",children:e.image_url?r.jsx("img",{src:e.image_url,alt:e.name,className:"max-h-32 object-contain"}):r.jsx("div",{className:"w-24 h-24 bg-gray-200 dark:bg-gray-600 rounded"})}),r.jsx("div",{className:"font-semibold text-lg mb-1 text-gray-900 dark:text-white",children:e.name}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsxs("span",{className:"text-primary-600 font-bold text-xl",children:["$",(e.price-e.price*(e.discount||0)/100).toFixed(2)]}),e.discount>0&&r.jsxs("span",{className:"line-through text-gray-400 text-sm",children:["$",e.price]})]}),r.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["by ",e.supplier_name||e.supplier?.name||"Unknown"]}),r.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded mt-auto disabled:opacity-60",onClick:t=>{t.stopPropagation(),E(e)},disabled:v[e.id],children:v[e.id]?"Adding...":"Add to Cart"})]},e.id))})]})}export{V as default};
