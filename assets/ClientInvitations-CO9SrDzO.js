import{S as ce,s as le,B as _,C as de,y as $,A as Q,r as n,n as ue,z as pe,u as he,a as me,b as xe,j as e}from"./index-BciHiggx.js";import{u as S}from"./useQuery-B5Do4Ucs.js";import{p as q,g as A}from"./api-BUuAVsLY.js";import{L as ge}from"./ErrorBoundary-CU19MtL8.js";import{S as H}from"./StatusBadge-CMhdMN1J.js";import{P as ye}from"./Pagination-BGThXI18.js";import{C as fe}from"./ConfirmModal-DeBDBchQ.js";import"./Modal-ZBCWTlSA.js";var ve=class extends ce{#s;#r=void 0;#e;#t;constructor(s,r){super(),this.#s=s,this.setOptions(r),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const r=this.options;this.options=this.#s.defaultMutationOptions(s),le(this.options,r)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),r?.mutationKey&&this.options.mutationKey&&_(r.mutationKey)!==_(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#a(),this.#i(s)}getCurrentResult(){return this.#r}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#a(),this.#i()}mutate(s,r){return this.#t=r,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#a(){const s=this.#e?.state??de();this.#r={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#i(s){$.batch(()=>{if(this.#t&&this.hasListeners()){const r=this.#r.variables,c=this.#r.context;s?.type==="success"?(this.#t.onSuccess?.(s.data,r,c),this.#t.onSettled?.(s.data,null,r,c)):s?.type==="error"&&(this.#t.onError?.(s.error,r,c),this.#t.onSettled?.(void 0,s.error,r,c))}this.listeners.forEach(r=>{r(this.#r)})})}};function K(s,r){const c=Q(),[l]=n.useState(()=>new ve(c,s));n.useEffect(()=>{l.setOptions(s)},[l,s]);const d=n.useSyncExternalStore(n.useCallback(u=>l.subscribe($.batchCalls(u)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),j=n.useCallback((u,b)=>{l.mutate(u,b).catch(ue)},[l]);if(d.error&&pe(l.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:j,mutateAsync:d.mutate}}function Le(){const{token:s}=he(),r=me(),c=Q(),l=xe(),[d,j]=n.useState(""),[u,b]=n.useState("all"),[k,U]=n.useState(1),[W,m]=n.useState(!1),[p,x]=n.useState(null),[o,g]=n.useState(null),[y,L]=n.useState(""),V=t=>{if(t.includes("/invitation/")){const i=t.split("/invitation/");return i[i.length-1].split("?")[0]}return t.trim()},{data:M,isLoading:z,error:I}=S({queryKey:["client-invitations",s],queryFn:async()=>s?(await A("/api/client/invitations",{token:s})).data||{invitations:[]}:{invitations:[]},enabled:!!s}),{data:P,isLoading:G}=S({queryKey:["client-relationships",s],queryFn:async()=>s?(await A("/api/client/invitations/relationships?per_page=100&paginated=true",{token:s})).data||{relationships:{data:[]}}:{relationships:{data:[]}},enabled:!!s}),{data:E,isLoading:J}=S({queryKey:["client-suppliers",s],queryFn:async()=>s?(await A("/api/client/invitations/suppliers",{token:s})).data||{suppliers:[]}:{suppliers:[]},enabled:!!s}),h=K({mutationFn:async t=>await q("/api/client/invitations/accept",{token:s,data:{token:t}}),onSuccess:()=>{r.show("Invitation accepted successfully!","success"),c.invalidateQueries(["client-invitations"]),c.invalidateQueries(["client-relationships"]),c.invalidateQueries(["client-suppliers"])},onError:t=>{r.show(t.message||"Failed to accept invitation","error")}}),R=K({mutationFn:async t=>await q("/api/client/invitations/reject",{token:s,data:{token:t}}),onSuccess:()=>{r.show("Invitation rejected successfully!","success"),c.invalidateQueries(["client-invitations"]),c.invalidateQueries(["client-relationships"])},onError:t=>{r.show(t.message||"Failed to reject invitation","error")}}),O=n.useMemo(()=>{const t=M?.invitations||[],i=P?.relationships?.data||[],f=E?.suppliers||[],N=new Map;f.forEach(a=>{const v=a.supplier_id||a.id,oe=a.supplier||a;N.set(v,oe)});let C=[...t.map(a=>({...a,type:"invitation",supplier:a.supplier||N.get(a.supplier_id)||{name:"Unknown Supplier",email:"N/A"},sent_date:a.created_at,status:a.status,access:"No Access"})),...i.map(a=>({...a,type:"relationship",supplier:a.supplier||N.get(a.supplier_id)||{name:"Unknown Supplier",email:"N/A"},sent_date:a.connected_at,status:a.status==="active"?"accepted":a.status,access:a.status==="active"?"Access Granted":"No Access"}))];const T=new Set;return C=C.filter(a=>{const v=`${a.supplier_id}-${a.status}`;return T.has(v)?!1:(T.add(v),!0)}),C},[M,P,E]),B=n.useMemo(()=>{let t=O;return d&&(t=t.filter(i=>i.supplier.name.toLowerCase().includes(d.toLowerCase())||i.supplier.email.toLowerCase().includes(d.toLowerCase()))),u!=="all"&&(t=t.filter(i=>i.status===u)),t},[O,d,u]),w=10,D=Math.ceil(B.length/w),F=B.slice((k-1)*w,k*w),X=t=>{x(t),g("accept"),m(!0)},Y=t=>{x(t),g("reject"),m(!0)},Z=()=>{r.show("Resend functionality coming soon!","info")},ee=t=>{const i=t.supplier_id||t.supplier?.id;i?l(`/client/dashboard/my-marketplace?supplier=${i}`):r.show("Supplier information not available","error")},te=()=>{if(!y.trim()){r.show("Please enter an invitation token.","warning");return}const t=V(y);h.mutate(t),L("")},se=()=>{if(p){switch(o){case"accept":h.mutate(p.token);break;case"reject":R.mutate(p.token);break}m(!1),x(null),g(null)}},re=t=>{const f={pending:{color:"orange",text:"Pending"},accepted:{color:"green",text:"Accepted"},rejected:{color:"red",text:"Rejected"},active:{color:"green",text:"Active"},suspended:{color:"gray",text:"Suspended"}}[t]||{color:"gray",text:t};return e.jsx(H,{status:f.text,color:f.color})},ae=t=>{const i=t==="Access Granted"?"green":"red";return e.jsx(H,{status:t,color:i})},ie=t=>t.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>X(t),className:"text-green-600 hover:text-green-700 font-medium text-sm transition-colors",children:"✓ Accept"}),e.jsx("button",{onClick:()=>Y(t),className:"text-red-600 hover:text-red-700 font-medium text-sm transition-colors",children:"✕ Reject"})]}):t.status==="accepted"||t.status==="active"?e.jsxs("button",{onClick:()=>ee(t),className:"text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Visit Store"]}):t.status==="rejected"?e.jsxs("button",{onClick:()=>Z(),className:"text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Resend Request"]}):null,ne=t=>t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A";return z||G||J?e.jsx(ge,{type:"dashboard"}):I?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-theme-text mb-2",children:"Failed to load invitations"}),e.jsx("p",{className:"text-theme-text-secondary",children:I.message})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-xl",children:e.jsx("svg",{className:"w-6 h-6 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Invitations"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-normal text-lg sm:text-xl ml-2",children:"Manage supplier invitations"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Accept, reject, or visit your connected suppliers."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Accept Invitation"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"If you received an invitation link from a supplier, enter the invitation token here to accept it."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Enter invitation token",className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",value:y,onChange:t=>L(t.target.value)}),e.jsx("button",{onClick:te,disabled:!y.trim()||h.isPending,className:"bg-primary-600 hover:bg-primary-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h.isPending?"Accepting...":"Accept Invitation"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by supplier name or email",value:d,onChange:t=>j(t.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200"})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:u,onChange:t=>b(t.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all duration-200",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gradient-to-r from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Supplier Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Supplier Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Categories"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Sent Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Actions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-primary-900 dark:text-primary-100 uppercase tracking-wider",children:"Access"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-400 dark:text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-200",children:"No invitations found"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Try adjusting your search or filter criteria"})]})})}):F.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.supplier.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.supplier.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.supplier.categories?t.supplier.categories.map(i=>i.name).join(", "):"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:re(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:ne(t.sent_date)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex space-x-3",children:ie(t)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ae(t.access)})]},`${t.type}-${t.id}`))})]})})}),D>1&&e.jsx("div",{className:"mt-6",children:e.jsx(ye,{currentPage:k,totalPages:D,onPageChange:U})}),e.jsx(fe,{open:W,onClose:()=>{m(!1),x(null),g(null)},onConfirm:se,title:o==="accept"?"Accept Invitation":o==="reject"?"Reject Invitation":o==="disconnect"?"Disconnect Supplier":"Confirm Action",message:o==="accept"?`Are you sure you want to accept the invitation from ${p?.supplier?.name}?`:o==="reject"?`Are you sure you want to reject the invitation from ${p?.supplier?.name}?`:o==="disconnect"?`Are you sure you want to disconnect from ${p?.supplier?.name}?`:"Are you sure you want to perform this action?",confirmText:o==="accept"?"Accept":o==="reject"?"Reject":o==="disconnect"?"Disconnect":"Confirm",confirmColor:o==="accept"?"green":o==="reject"||o==="disconnect"?"red":"blue",loading:h.isPending||R.isPending})]})}export{Le as default};
